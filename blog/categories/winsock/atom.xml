<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Winsock | Coding4ever's Blog]]></title>
  <link href="http://coding4ever.net/blog/categories/winsock/atom.xml" rel="self"/>
  <link href="http://coding4ever.net/"/>
  <updated>2015-07-06T05:31:18+07:00</updated>
  <id>http://coding4ever.net/</id>
  <author>
    <name><![CDATA[Admin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Aplikasi Antrian]]></title>
    <link href="http://coding4ever.net/blog/2012/02/26/aplikasi-antrian/"/>
    <updated>2012-02-26T10:02:09+07:00</updated>
    <id>http://coding4ever.net/blog/2012/02/26/aplikasi-antrian</id>
    <content type="html"><![CDATA[<p>Aplikasi ini merupakan pengembangan dari sample aplikasi yg sudah pernah saya bahas pada postingan <a href="/blog/2010/01/30/belajar-winsock-bagian-3-%e2%80%93-multiple-connection/">sebelumnya</a>, aplikasi ini terdiri dari 2 project yaitu :</p>

<ol>
<li><p> Aplikasi server memanfaatkan array winsock karena akan menghandle minimal 1 koneksi</p></li>
<li><p> Untuk aplikasi klien cukup menggunakan winsock standar (non array).</p></li>
</ol>


<!-- more -->


<p><a href="http://coding4ever.files.wordpress.com/2012/02/26022012-2.png"><img src="http://coding4ever.files.wordpress.com/2012/02/26022012-2.png" alt="" /></a></p>

<p>Sekarang akan kita bahas cara pembuatannya.</p>

<p><strong>Aplikasi server</strong></p>

<p>Aplikasi server menggunakan winsock yg dijadikan array karena akan menerima lebih dari 1 koneksi, untuk menjadikan sebuah winsock menjadi array cukup dengan mengeset properties index = 0</p>

<p><a href="http://coding4ever.files.wordpress.com/2012/02/26022012-1.png"><img src="http://coding4ever.files.wordpress.com/2012/02/26022012-1.png" alt="" /></a></p>

<p>Selain itu agar sebuah winsock bisa menerima koneksi yg masuk, maka winsocknya harus dalam mode &ldquo;Listen&rdquo;, untuk keperluan ini kita akan menyiapkan sebuah fungsi misal dengan nama startListening</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Function</span> <span class="nf">startListening</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">localPort</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">Boolean</span>
</span><span class='line'>    <span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">If</span> <span class="n">localPort</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>    <span class="c">&#39;If the socket is already listening, and it&#39;s listening on the same port, don&#39;t bother restarting it.</span>
</span><span class='line'>    <span class="k">If</span> <span class="p">(</span><span class="n">wckServer</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">State</span> <span class="o">&amp;</span><span class="n">lt</span><span class="err">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="n">sckListening</span><span class="p">)</span> <span class="ow">Or</span> <span class="p">(</span><span class="n">wckServer</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">localPort</span> <span class="o">&amp;</span><span class="n">lt</span><span class="err">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="n">localPort</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>        <span class="k">With</span> <span class="n">wckServer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="k">Call</span> <span class="p">.</span><span class="n">Close</span>
</span><span class='line'>            <span class="p">.</span><span class="n">localPort</span> <span class="o">=</span> <span class="n">localPort</span>
</span><span class='line'>            <span class="k">Call</span> <span class="p">.</span><span class="n">Listen</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">With</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&#39;Return true, since the server is now listening for clients.</span>
</span><span class='line'>    <span class="n">startListening</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span>   <span class="k">End</span> <span class="k">If</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span>   <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'><span class="nf">errHandle</span><span class="p">:</span>
</span><span class='line'>   <span class="n">startListening</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Selanjutnya tinggal kita panggil pada event Form_Load</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">Form_Load</span><span class="p">()</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lsquo</span><span class="err">;</span><span class="mi">1234</span> <span class="n">adalah</span> <span class="n">port</span> <span class="n">yg</span> <span class="n">digunakan</span> <span class="n">untuk</span> <span class="n">komunikasi</span>
</span><span class='line'>    <span class="c">&#39;antara server dan klien, nilainya bisa disesuaikan</span>
</span><span class='line'>    <span class="k">If</span> <span class="n">startListening</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>        <span class="n">MsgBox</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="err">;</span><span class="n">Status</span> <span class="n">Server</span> <span class="k">ON</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="err">;</span>
</span><span class='line'>    <span class="k">Else</span>
</span><span class='line'>        <span class="n">MsgBox</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="err">;</span><span class="n">Status</span> <span class="n">Server</span> <span class="n">OFF&amp;rdquo</span><span class="err">;</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Selain itu ada beberapa kode yang harus kita lengkapi pada event2x yg dimiliki oleh winsock yaitu event Close, ConnectionRequest, DataArrival dan Error</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">wckServer_Close</span><span class="p">(</span><span class="n">Index</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">)</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lsquo</span><span class="err">;</span> <span class="n">Close</span> <span class="n">the</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">raise</span> <span class="n">the</span> <span class="k">event</span> <span class="k">to</span> <span class="n">the</span> <span class="n">parent</span><span class="p">.</span>
</span><span class='line'>    <span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">Index</span><span class="p">).</span><span class="n">Close</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">wckServer_ConnectionRequest</span><span class="p">(</span><span class="n">Index</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">requestID</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">)</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">i</span>          <span class="ow">As</span> <span class="kt">Long</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">j</span>          <span class="ow">As</span> <span class="kt">Long</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">blnLoaded</span>  <span class="ow">As</span> <span class="kt">Boolean</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span>
</span><span class='line'>
</span><span class='line'><span class="c">&#39; We shouldn&#39;t get ConnectionRequests on any other socket than the listener</span>
</span><span class='line'><span class="c">&#39; (index 0), but check anyway. Also check that we&#39;re not going to exceed</span>
</span><span class='line'><span class="c">&#39; the MaxClients property.</span>
</span><span class='line'><span class="k">If</span> <span class="p">(</span><span class="n">Index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>    <span class="c">&#39; Check to see if we&#39;ve got any sockets that are free.</span>
</span><span class='line'>    <span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">To</span> <span class="n">wckServer</span><span class="p">.</span><span class="n">UBound</span>
</span><span class='line'>        <span class="k">If</span> <span class="p">(</span><span class="n">wckServer</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">State</span> <span class="o">=</span> <span class="n">sckClosed</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
</span><span class='line'>            <span class="k">Exit</span> <span class="k">For</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>    <span class="k">Next</span> <span class="n">i</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&#39; If we don&#39;t have any free sockets, load another on the array.</span>
</span><span class='line'>    <span class="k">If</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>        <span class="n">blnLoaded</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'>        <span class="k">Call</span> <span class="n">Load</span><span class="p">(</span><span class="n">wckServer</span><span class="p">(</span><span class="n">wckServer</span><span class="p">.</span><span class="n">UBound</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>        <span class="n">j</span> <span class="o">=</span> <span class="n">wckServer</span><span class="p">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&#39; With the selected socket, reset it and accept the new connection.</span>
</span><span class='line'>    <span class="k">With</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span><span class='line'>        <span class="k">Call</span> <span class="p">.</span><span class="n">Close</span>
</span><span class='line'>        <span class="k">Call</span> <span class="p">.</span><span class="n">Accept</span><span class="p">(</span><span class="n">requestID</span><span class="p">)</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">With</span>
</span><span class='line'>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="k">Exit</span> <span class="k">Sub</span>
</span><span class='line'><span class="err">&#39;</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="n">errHandle</span><span class="p">:</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lsquo</span><span class="err">;</span> <span class="n">Close</span> <span class="n">the</span> <span class="n">Winsock</span> <span class="n">that</span> <span class="n">caused</span> <span class="n">the</span> <span class="k">error</span><span class="p">.</span>
</span><span class='line'>    <span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Close</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Event ConnectionRequest berfungsi untuk memfilter koneksi yg masuk, jika ada koneksi yg masuk akan dilakukan pengecekan terlebih dulu apakah ada winsock yg idle (ngangur) jika ada maka koneksi tersebut akan langsung dihandle oleh winsock yg idle tadi, jika tidak maka akan diload terlebih dulu winsock yg baru kemudian langsung menghandle koneksi yg baru masuk tadi.</p>

<p>Teknik ini merupakah salah satu cara untuk melakukan optimasi program jangan sampai aplikasi server meload secara terus menerus objek winsock yg baru untuk setiap koneksi yg masuk.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">wckServer_DataArrival</span><span class="p">(</span><span class="n">Index</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">bytesTotal</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">)</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">cmd</span>     <span class="ow">As</span> <span class="kt">String</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span>
</span><span class='line'>
</span><span class='line'><span class="c">&#39; Grab the data from the specified Winsock object, and pass it to the parent.</span>
</span><span class='line'><span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">Index</span><span class="p">).</span><span class="n">GetData</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">Select</span> <span class="k">Case</span> <span class="n">cmd</span>
</span><span class='line'>    <span class="k">Case</span> <span class="s">&quot;get_no_antrian&quot;</span>
</span><span class='line'>        <span class="k">Call</span> <span class="n">send</span><span class="p">(</span><span class="n">Index</span><span class="p">,</span> <span class="k">CStr</span><span class="p">(</span><span class="n">noAntrian</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">lblNoAntrian</span><span class="p">.</span><span class="n">Caption</span> <span class="o">=</span> <span class="n">noAntrian</span>
</span><span class='line'>        <span class="n">noAntrian</span> <span class="o">=</span> <span class="n">noAntrian</span> <span class="o">+</span> <span class="mi">1</span> <span class="c">&#39; naikkan counter nomor antrian</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Case</span> <span class="k">Else</span>
</span><span class='line'>        <span class="k">Call</span> <span class="n">send</span><span class="p">(</span><span class="n">Index</span><span class="p">,</span> <span class="s">&quot;perintah tidak dikenal&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">End</span> <span class="k">Select</span>
</span><span class='line'>
</span><span class='line'><span class="k">Exit</span> <span class="k">Sub</span>
</span><span class='line'><span class="err">&lt;/</span><span class="nf">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="n">errHandle</span><span class="p">:</span>
</span><span class='line'>   <span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">Index</span><span class="p">).</span><span class="n">Close</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Event DataArrival berfungsi untuk memproses data yg masuk, untuk kasus aplikasi antrian ini data yang paling valid hanya berupa string &ldquo;get_no_antrian&rdquo;, jika datanya valid akan langsung dikirimkan nomor antrian terakhir ke klien yg mengirimkan string &ldquo;get_no_antrian&rdquo; dg memanggil prosedur send.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">send</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">lngIndex</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">strData</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span>
</span><span class='line'>    <span class="k">If</span> <span class="p">(</span><span class="n">wckServer</span><span class="p">(</span><span class="n">lngIndex</span><span class="p">).</span><span class="n">State</span> <span class="o">=</span> <span class="n">sckConnected</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>        <span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">lngIndex</span><span class="p">).</span><span class="n">SendData</span><span class="p">(</span><span class="n">strData</span><span class="p">):</span> <span class="n">DoEvents</span>
</span><span class='line'>    <span class="k">Else</span>
</span><span class='line'>        <span class="k">Exit</span> <span class="k">Sub</span>
</span><span class='line'>    <span class="nf">End</span> <span class="k">If</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">wckServer_Error</span><span class="p">(</span><span class="n">Index</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">Number</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="n">Description</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">Scode</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">Source</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">HelpFile</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">HelpContext</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">,</span> <span class="n">CancelDisplay</span> <span class="ow">As</span> <span class="kt">Boolean</span><span class="p">)</span>
</span><span class='line'>    <span class="k">Call</span> <span class="n">wckServer</span><span class="p">(</span><span class="n">Index</span><span class="p">).</span><span class="n">Close</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Untuk aplikasi server sy rasa sudah cukup akan kita lanjutkan dg aplikasi klien.</p>

<p><strong>Aplikasi Klien</strong></p>

<p>Untuk aplikasi klien lebih sederhana lagi, yg kita butuhkan cukup sebuah fungsi untuk melakukan koneksi ke server</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Const</span> <span class="n">conTunggu</span> <span class="ow">As</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">100000</span>
</span></code></pre></td></tr></table></div></figure>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Function</span> <span class="nf">isConnected</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">ipServer</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">port</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">Boolean</span>
</span><span class='line'>    <span class="k">Static</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Long</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">On</span> <span class="k">Error</span> <span class="k">Resume</span> <span class="k">Next</span>
</span><span class='line'>
</span><span class='line'><span class="k">If</span> <span class="n">myClient</span><span class="p">.</span><span class="n">State</span> <span class="o">&amp;</span><span class="n">lt</span><span class="err">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="n">sckClosed</span> <span class="k">Then</span> <span class="n">myClient</span><span class="p">.</span><span class="n">Close</span> <span class="c">&#39; close existing connection</span>
</span><span class='line'><span class="n">myClient</span><span class="p">.</span><span class="n">RemoteHost</span> <span class="o">=</span> <span class="n">ipServer</span>
</span><span class='line'><span class="n">myClient</span><span class="p">.</span><span class="n">RemotePort</span> <span class="o">=</span> <span class="n">port</span>
</span><span class='line'><span class="n">myClient</span><span class="p">.</span><span class="n">Connect</span>
</span><span class='line'>
</span><span class='line'><span class="k">With</span> <span class="n">myClient</span>
</span><span class='line'>    <span class="k">Do</span> <span class="n">Until</span> <span class="p">.</span><span class="n">State</span> <span class="o">=</span> <span class="n">sckConnected</span>
</span><span class='line'>        <span class="n">DoEvents</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">If</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span><span class="o">=</span> <span class="n">conTunggu</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>        <span class="nf">End</span> <span class="k">If</span>
</span><span class='line'>    <span class="k">Loop</span>
</span><span class='line'><span class="k">End</span> <span class="k">With</span>
</span><span class='line'>
</span><span class='line'><span class="n">isConnected</span> <span class="o">=</span> <span class="n">myClient</span><span class="p">.</span><span class="n">State</span> <span class="o">=</span> <span class="n">sckConnected</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Contoh pemanggilan fungsi diatas seperti berikut :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">cmdAmbilNoAntrian_Click</span><span class="p">()</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">ipServer</span>    <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">cmd</span>         <span class="ow">As</span> <span class="kt">String</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">ipServer</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span>
</span><span class='line'><span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;get_no_antrian&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&#39; 1234 ada port yg menyesuaikan port yg ada di server</span>
</span><span class='line'><span class="k">If</span> <span class="n">isConnected</span><span class="p">(</span><span class="n">ipServer</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>    <span class="n">myClient</span><span class="p">.</span><span class="n">SendData</span> <span class="n">cmd</span>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Untuk mengetahui data yang dikirim balik oleh server kita bisa memanfaatkan event DataArrival yg dimiliki oleh objek winsock</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">myClient_DataArrival</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">bytesTotal</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">)</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">noAntrian</span> <span class="ow">As</span> <span class="kt">String</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">On</span> <span class="k">Error</span> <span class="k">Resume</span> <span class="k">Next</span>
</span><span class='line'>
</span><span class='line'><span class="n">myClient</span><span class="p">.</span><span class="n">GetData</span> <span class="n">noAntrian</span>
</span><span class='line'><span class="n">lblNoAntrian</span><span class="p">.</span><span class="n">Caption</span> <span class="o">=</span> <span class="n">noAntrian</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Selesai :)</p>

<p>Aplikasi diatas belum menggunakan database sama sekali, sehingga jika aplikasi server ditutup maka counter nomor antrian akan dimulai dari 1 lagi, dan sy berharap tidak ada pertanyaan bagaimana menyimpan counter nomor antriannya ke database atw bagaimana cara menampilkan nomor atrian terakhir klo servernya error :D.</p>

<p>Selamat <a href="https://github.com/k4m4r82/Antrian">MENCOBA</a> :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Belajar Winsock Bagian Akhir – Contoh Kasus Mengakses Data Stok Barang Dari Luar]]></title>
    <link href="http://coding4ever.net/blog/2010/02/04/belajar-winsock-bagian-akhir-e28093-contoh-kasus-mengakses-data-stok-barang-dari-luar/"/>
    <updated>2010-02-04T16:47:57+07:00</updated>
    <id>http://coding4ever.net/blog/2010/02/04/belajar-winsock-bagian-akhir-e28093-contoh-kasus-mengakses-data-stok-barang-dari-luar</id>
    <content type="html"><![CDATA[<p>Akhirnya rilis juga artikel terakhir dari 5 seri belajar winsock ini, sebelum kita melanjutkan pembahasan ada baiknya kita melakukan sedikit review :</p>

<ol>
<li><p> <a href="/blog/2010/01/26/belajar-winsock-bagian-1-intro/">Dasar-dasar penggunaan winsock</a> sudah kita pelajari</p></li>
<li><p> Ini terbukti dengan suksesnya kita membuat <a href="/blog/2010/01/28/belajar-winsock-bagian-2-membuat-aplikasi-chat-sederhana-11/">aplikasi chat sederhana</a></p></li>
<li><p> Di tambah lagi ada teman kita yang mau nebeng sehingga terciptanya <a href="/blog/2010/01/30/belajar-winsock-bagian-3-%E2%80%93-multiple-connection/">aplikasi chat multiple connection</a></p></li>
<li><p> <a href="/blog/2010/02/02/belajar-winsock-bagian-4-%e2%80%93-membuat-jaringan-vpn-sendiri/">Jalan tol</a> antara laptop mas Paijo dan komputer server tokonya juga udah selesai dibangun dengan anggaran 0 Rp :D</p></li>
</ol>


<!-- more -->


<p>Berarti sekarang waktu yang tepat untuk mencoba ketangguhan mas Win (maksudnya Winsock :D) kalo lari jarak dekat (jaringan LAN) masih bisa diandalkan, bagai mana dengan lari jarak jauh (via internet) apakah juga masih bisa diandalkan ?</p>

<p>Objek-objek yang akan dijadikan korban untuk uji coba kali ini :</p>

<ol>
<li><p> Database barang dengan format ms access</p></li>
<li><p> Aplikasi server</p></li>
<li><p> Aplikasi klien</p></li>
</ol>


<p>Data yang dikirim dari server dibatasi maksimal 1024 karakter dalam sekali kirim, otomatis jika data > 1024 akan dipecah menjadi beberapa paket, berikut cuplikan kodenya (server) :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Option Explicit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Const LOCAL_PORT As Long = 1007&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Const REC_SPR As String * 1 = &ldquo;|&rdquo; &lsquo;separator baris
</span><span class='line'>Private Const FLD_SPR As String * 1 = &ldquo;#&rdquo; 'separator kolom
</span><span class='line'>Private Const MAX_LIMIT As Long = 1024 '1x kirim dibatasi 1 kb, kalo untuk jaringan lokal masih bisa set 4096&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Function pembulatanKeAtas(ByVal X As Double, Optional ByVal Factor As Double = 1) As Double
</span><span class='line'>    Dim temp As Double&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>temp = Int(X * Factor)
</span><span class='line'>pembulatanKeAtas = (temp + IIf(X = temp, 0, 1)) / Factor
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Function&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Function getDataBarang(ByVal param As String) As String()
</span><span class='line'>    Dim rs          As ADODB.Recordset&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>Dim div         As Long
</span><span class='line'>Dim lengthData  As Long
</span><span class='line'>Dim n           As Long
</span><span class='line'>Dim i           As Long
</span><span class='line'>
</span><span class='line'>Dim tmp         As String
</span><span class='line'>Dim arrTmp()    As String
</span><span class='line'>
</span><span class='line'>strSql = "SELECT UCASE(nama), harga, stok FROM barang " &amp; param &amp; ""
</span><span class='line'>Set rs = openRecordset(strSql)
</span><span class='line'>If Not rs.EOF Then
</span><span class='line'>    For i = 1 To getRecordCount(rs)
</span><span class='line'>        tmp = tmp &amp; rs(0).Value &amp; FLD_SPR &amp; rs(1).Value &amp; FLD_SPR &amp; rs(2).Value &amp; REC_SPR
</span><span class='line'>
</span><span class='line'>        rs.MoveNext
</span><span class='line'>    Next i
</span><span class='line'>    If Len(tmp) &gt; 0 Then tmp = Left(tmp, Len(tmp) - 1)
</span><span class='line'>
</span><span class='line'>    'karakter ~ sebagai penanda awal dan akhir data
</span><span class='line'>    'untuk memudahkan pengecekan di klien bahwa data yg diterima sudah lengkap/belum
</span><span class='line'>    'ex : ~DATA BARANG + SEPARATOR KOLOM DAN BARIS~
</span><span class='line'>
</span><span class='line'>    'contoh format data disini ada 2 :
</span><span class='line'>    '1. jika data &lt;= 1024 karakter : ~~DATA BARANG + SEPARATOR KOLOM DAN BARIS
</span><span class='line'>    '2. jika data &gt; 1024 karakter  : ~DATA BARANG + SEPARATOR KOLOM DAN BARIS~
</span><span class='line'>
</span><span class='line'>    If Len(tmp) &gt; 0 Then tmp = "~" &amp; Left(tmp, Len(tmp) - 1) &amp; "~"
</span><span class='line'>    If Not Len(tmp) &gt; MAX_LIMIT Then
</span><span class='line'>        tmp = Left(tmp, Len(tmp) - 1)
</span><span class='line'>        tmp = "~" &amp; tmp
</span><span class='line'>    End If
</span><span class='line'>
</span><span class='line'>    lengthData = Len(tmp)
</span><span class='line'>    If lengthData &gt; 0 Then
</span><span class='line'>        If lengthData &gt; MAX_LIMIT Then 'data &gt; 1024 karakter
</span><span class='line'>            'data dibuat menjadi beberapa package
</span><span class='line'>            'ex : jika jumlah karakter 2345
</span><span class='line'>            '     package 1 -&gt; 1024
</span><span class='line'>            '     package 2 -&gt; 1024
</span><span class='line'>            '     package 3 -&gt; 297
</span><span class='line'>            '     berarti data yg dikirim ke klien sebanyak 3 x
</span><span class='line'>
</span><span class='line'>            div = pembulatanKeAtas(lengthData / MAX_LIMIT)
</span><span class='line'>            ReDim arrTmp(div)
</span><span class='line'>
</span><span class='line'>            n = 1
</span><span class='line'>            For i = 1 To div
</span><span class='line'>                arrTmp(i - 1) = Mid(tmp, n, MAX_LIMIT)
</span><span class='line'>                n = n + MAX_LIMIT
</span><span class='line'>            Next i
</span><span class='line'>
</span><span class='line'>        Else
</span><span class='line'>            ReDim arrTmp(0)
</span><span class='line'>            arrTmp(0) = tmp
</span><span class='line'>        End If
</span><span class='line'>
</span><span class='line'>    Else
</span><span class='line'>        ReDim arrTmp(0)
</span><span class='line'>        arrTmp(0) = tmp
</span><span class='line'>    End If
</span><span class='line'>
</span><span class='line'>Else
</span><span class='line'>    ReDim arrTmp(0)
</span><span class='line'>    arrTmp(0) = "EOF" 'data barang tidak ditemukan
</span><span class='line'>End If
</span><span class='line'>Call closeRecordset(rs)
</span><span class='line'>
</span><span class='line'>getDataBarang = arrTmp
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Function</span></code></pre></td></tr></table></div></figure></p>

<p>pengiriman data ke klien akan dihandle oleh event DataArrival :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Socket_DataArrival(Index As Integer, ByVal bytesTotal As Long)
</span><span class='line'>    Dim i           As Long
</span><span class='line'>    Dim strData     As String
</span><span class='line'>    Dim ret         As Boolean&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>Dim arrTmp()    As String
</span><span class='line'>
</span><span class='line'>'On Error GoTo errHandle
</span><span class='line'>
</span><span class='line'>' Grab the data from the specified Winsock object, and pass it to the parent.
</span><span class='line'>Call Socket(Index).GetData(strData)
</span><span class='line'>DoEvents
</span><span class='line'>
</span><span class='line'>arrTmp = getDataBarang(strData)
</span><span class='line'>For i = LBound(arrTmp) To UBound(arrTmp)
</span><span class='line'>    If Len(arrTmp(i)) &gt; 0 Then ret = send(Index, arrTmp(i))
</span><span class='line'>Next i
</span><span class='line'>
</span><span class='line'>Exit Sub
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>errHandle:
</span><span class='line'>   Call Socket(Index).Close
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>sedangkan untuk aplikasi klien bagian yg bertugas menerima data masih di event yang sama yaitu DataArrival :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Socket_DataArrival(ByVal bytesTotal As Long)
</span><span class='line'>    Dim dataMasuk   As String&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>'On Error Resume Next
</span><span class='line'>
</span><span class='line'>Socket.GetData dataMasuk
</span><span class='line'>
</span><span class='line'>If Left(dataMasuk, 2) = "~~" Then 'package data &lt;= 1024
</span><span class='line'>    Call execOutput(dataMasuk)
</span><span class='line'>
</span><span class='line'>ElseIf dataMasuk = "EOF" Then 'data tidak ditemukan
</span><span class='line'>    Call execOutput(dataMasuk)
</span><span class='line'>
</span><span class='line'>Else
</span><span class='line'>    'package data &gt; 1024
</span><span class='line'>    'berikut kode untuk penggabungan package data
</span><span class='line'>    tmp = tmp &amp; dataMasuk
</span><span class='line'>    If InStr(1, dataMasuk, "~") &gt; 0 Then packageHdr = packageHdr &amp; "~"
</span><span class='line'>
</span><span class='line'>    If Len(packageHdr) = 2 Then Call execOutput(tmp) 'penggabungan package data selesai
</span><span class='line'>End If
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>dan ini prosedure yang bertanggung jawab untuk memparsing data dan menampilkan ke ListView :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub execOutput(ByVal data As String)
</span><span class='line'>    Dim rec()   As String
</span><span class='line'>    Dim fld()   As String&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>Dim x       As Long
</span><span class='line'>Dim noUrut  As Long
</span><span class='line'>
</span><span class='line'>On Error GoTo errHandle
</span><span class='line'>
</span><span class='line'>Screen.MousePointer = vbHourglass
</span><span class='line'>DoEvents
</span><span class='line'>
</span><span class='line'>If Left(data, 2) = "~~" Then 'complete
</span><span class='line'>    data = Replace(data, "~~", "")
</span><span class='line'>
</span><span class='line'>ElseIf data = "EOF" Then
</span><span class='line'>    'do nothing
</span><span class='line'>
</span><span class='line'>Else
</span><span class='line'>    data = Left(data, Len(data) - 1) 'remove ~ left
</span><span class='line'>    data = Right(data, Len(data) - 1) 'remove ~ right
</span><span class='line'>End If
</span><span class='line'>
</span><span class='line'>lsvBarang.ListItems.Clear
</span><span class='line'>
</span><span class='line'>If data = "EOF" Then
</span><span class='line'>    Screen.MousePointer = vbDefault
</span><span class='line'>    MsgBox "Data barang dengan keyword '" &amp; txtNamaBarang.Text &amp; "' tidak ditemukan", vbInformation, "Informasi"
</span><span class='line'>
</span><span class='line'>Else
</span><span class='line'>    'contoh data :
</span><span class='line'>    '~~SUSU KEDELAI ABC 200M#1000#24|SUSU KEDELAI MELILEA 500#1000#0|KOPI SUSU KPL API 3P#1000#0|SUSU KEDELAI ABC 200#1000#2
</span><span class='line'>    '| -&gt; pemisah baris
</span><span class='line'>    '# -&gt; pemisah kolom
</span><span class='line'>
</span><span class='line'>    rec = Split(data, REC_SPR)
</span><span class='line'>
</span><span class='line'>    With lsvBarang
</span><span class='line'>        noUrut = 1
</span><span class='line'>        For x = LBound(rec) To UBound(rec)
</span><span class='line'>            fld = Split(rec(x), FLD_SPR)
</span><span class='line'>
</span><span class='line'>            .ListItems.Add , , noUrut
</span><span class='line'>            .ListItems(noUrut).SubItems(1) = fld(0) 'nama barang
</span><span class='line'>            .ListItems(noUrut).SubItems(2) = FormatNumber(fld(1), 0) 'harga
</span><span class='line'>            .ListItems(noUrut).SubItems(3) = fld(2) 'stok
</span><span class='line'>
</span><span class='line'>            noUrut = noUrut + 1
</span><span class='line'>        Next x
</span><span class='line'>    End With
</span><span class='line'>End If
</span><span class='line'>
</span><span class='line'>Screen.MousePointer = vbDefault
</span><span class='line'>
</span><span class='line'>Exit Sub
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>errHandle:
</span><span class='line'>    Screen.MousePointer = vbDefault
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>dan ini hasilnya</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/04022010-1.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/04022010-1.jpg?w=300" alt="" /></a></p>

<p>mas Paijo mengetikan keyword <strong>mie</strong> kemudian mengirimkannya ke server dan akan diproses dengan hasil rincian sbb :</p>

<ol>
<li><p> Jumlah record yang ditemukan sebanyak 181 record</p></li>
<li><p> Jumlah karakter nama barang + harga + stok + seperator = 5084 karakter dan dikirim menjadi beberapa paket</p></li>
<li><p> Hasil akhir klien juga menampilkan sebanyak 181 record, yang berarti bahwa uji coba kita berhasil :D</p></li>
</ol>


<p>Dan yang terpenting dari pembahasan ini, sample programnya bisa didownload di<a href="https://github.com/k4m4r82/AplikasiChat3">sini</a> :)</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Belajar Winsock Bagian 4 – Membuat Jaringan VPN Sendiri]]></title>
    <link href="http://coding4ever.net/blog/2010/02/02/belajar-winsock-bagian-4-e28093-membuat-jaringan-vpn-sendiri/"/>
    <updated>2010-02-02T03:19:07+07:00</updated>
    <id>http://coding4ever.net/blog/2010/02/02/belajar-winsock-bagian-4-e28093-membuat-jaringan-vpn-sendiri</id>
    <content type="html"><![CDATA[<p>Pada artikel kali ini kita stop dulu untuk mengetikan baris-baris kode yang indah itu :D dan kita akan mencoba untuk membuat jaringan <a href="http://id.wikipedia.org/wiki/VPN">VPN</a> sendiri yang tentunya dengan investasi yang murah meriah :D dan nyaris dengan biaya 0 rupiah. G percaya ? Oke kita ikuti saja pembahasan berikut.</p>

<p>Misalkan kita punya klien sebutnya saja namanya mas Paijo yang sudah menggunakan program retail kita selama beberapa tahun. Mas Paijo ini sering berbelanja untuk keperluan tokonya ke luar kota dan masalah yang dihadapinya adalah kesulitan untuk mengecek jumlah stok barang di toko (selama ini untuk menanyakan jumlah stok masih telp2xan :D), dan baru-baru ini mas Paijo menghubungi kita untuk minta dibuatkan program kecil yang hanya sekedar untuk mengecek stok barang.</p>

<!-- more -->


<p>Hasil akhir pembicaraan disepakati perangkat jaringan yang akan digunakan adalah sebagai berikut :</p>

<ol>
<li><p> Komputer server untuk akses internetnya cukup menggunakan speedy dan hanya mendapatkan ip private.</p></li>
<li><p> Laptop mas Paijo rencananya menggunakan modem CDMA (bisa starone atau lainnya) kita anggap saja menggunakan starone.</p></li>
</ol>


<p>Beberapa solusi yang bisa kita tawarkan adalah sebagai berikut :</p>

<ol>
<li><p> Menggunakan program remote seperti <a href="www.teamviewer.com">Teamviewer</a> atau <a href="www.crossloop.com">CrossLoop</a>. Loh kok enggak pake program remote seperti <a href="www.radmin.com">Radmin</a>, <a href="www.netsupportmanager.com">Net Support Manager</a>, atau <a href="www.realvnc.com">RealVNC</a> ? Ya jelas enggak bisa, karena komputer servernya hanya mendapatkan ip private kecuali kalo kita mau direportkan dengan menyeting <a href="http://portforward.com/">portforwarding</a>nya.</p></li>
<li><p> Membuat program sendiri dengan menggunakan komponen Winsock, nah kalo ini cocox karena memang itu intinya dibuat artikel ke 4 ini :D</p></li>
</ol>


<p>Oke sampai disini kita sudah menentukan pilihan tetapi masalah baru muncul jangankan untuk mengakses data di komputer toko mau ngePING aja selalu Request timed out.</p>

<p>Tapi jangan kuatir setiap masalah selalu ada penyelesaiannya dan penyelesaian yang paling sederhana untuk kasus kita kali ini adalah membuat jaringan VPN sendiri dengan bantuan <a href="https://secure.logmein.com/US/products/hamachi2/">LogMeIn Hamachi</a>.</p>

<p>Berikut adalah langkah-langkah mulai dari pendaftaran, konfigurasi dan tentu saja sampai ngPINGnya berhasil :D</p>

<ol>
<li>Mendaftar dulu di<a href="https://secure.logmein.com/US/products/hamachi2/register.aspx">sini</a></li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-1.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-1.jpg?w=266" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-2.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-2.jpg?w=300" alt="" /></a></p>

<ol>
<li>Setelah proses mendaftar selesai kita lanjutkan dengan membuat jaringan</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-3.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-3.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-4.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-4.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-5.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-5.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-6.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-6.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-7.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-7.jpg?w=300" alt="" /></a></p>

<ol>
<li>Langkah berikutnya adalah mendownload LogMeIn Hamachi Installer</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-8.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-8.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-9.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-9.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-10.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-10.jpg?w=300" alt="" /></a></p>

<p>Sambil menungu proses download selesai kita bisa logout dulu dari situs LogMeIn Hamachi.</p>

<ol>
<li>Setelah download selesai copykan file installer tadi ke laptop mas Paijo dan lakukan instalasi, setelah itu jalankan program LogMeIn Hamachi</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-111.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-111.jpg?w=300" alt="" /></a></p>

<ol>
<li>Selanjutkan kita akan mengganti informasi nama komputer dengan cara klik menu System -> Preferences &hellip;</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-12.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-12.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-13.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-13.jpg?w=300" alt="" /></a></p>

<ol>
<li>Bergabung dengan <strong>Jaringan Tokonya Mas Paijo</strong> dengan mengklik menu Network -> Join an existing network &hellip; atau cukup dengan mengklik tombol Join an existing network &hellip;</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-19.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-19.jpg?w=186" alt="" /></a></p>

<p>Setelah itu kita diminta untuk memasukkan Network ID dan Password</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-141.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-141.jpg?w=300" alt="" /></a></p>

<p>jika berhasil akan kita dapatkan tampilan lebih kurang seperti berikut :</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-15.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-15.jpg?w=186" alt="" /></a></p>

<ol>
<li><p>Ulangi langkah 4 sampai 6 di komputer server</p></li>
<li><p>Setelah instalasi + konfigurasi di komputer server selesai, coba kita cek masing-masing program LogMeIn Hamachi maka kita akan mendapatkan tampilan seperti berikut :</p></li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-16.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-16.jpg?w=300" alt="" /></a></p>

<ol>
<li>Biar semakin manteb kita login ulang ke<a href="https://secure.logmein.com/US/products/hamachi2/">sini</a> dan jika kita mendapatkan tampilannya seperti berikut berarti langkah-langkah sebelumnya sudah 100% berhasil :)</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-17.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-17.jpg?w=300" alt="" /></a></p>

<p>dan otomatis kita juga bisa langsung menggunakan program-program remote seperti <a href="www.radmin.com">Radmin</a>, <a href="www.netsupportmanager.com">Net Support Manager</a>, atau <a href="www.realvnc.com">RealVNC</a> karena kita sudah mendapatkan IP Publik sendiri</p>

<ol>
<li>Terakhir kita akan mencoba ngePING komputer server</li>
</ol>


<p><a href="http://coding4ever.files.wordpress.com/2010/02/02022010-18.jpg"><img src="http://coding4ever.files.wordpress.com/2010/02/02022010-18.jpg?w=300" alt="" /></a></p>

<p>Jika hasil ping masih Request timed out coba nonaktifkan windows firewall di komputer server kemudian coba di ping lagi.</p>

<p>Oke sampai disini kita sudah berhasil membuat jaringan VPN sendiri dan memudahkan saya untuk menulis artikel terakhir yang insya Alloh dengan judul <a href="/blog/2010/02/04/belajar-winsock-bagian-akhir-%e2%80%93-contoh-kasus-mengakses-data-stok-barang-dari-luar/">Belajar Winsock bagian akhir – Contoh kasus mengakses data stok barang dari luar</a>.</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Belajar Winsock Bagian 3 – Multiple Connection]]></title>
    <link href="http://coding4ever.net/blog/2010/01/30/belajar-winsock-bagian-3-e28093-multiple-connection/"/>
    <updated>2010-01-30T10:52:28+07:00</updated>
    <id>http://coding4ever.net/blog/2010/01/30/belajar-winsock-bagian-3-e28093-multiple-connection</id>
    <content type="html"><![CDATA[<p>Di <a href="/blog/2010/01/28/belajar-winsock-bagian-2-membuat-aplikasi-chat-sederhana-11/">postingan</a> saya sebelumnya kita sudah mengetahui bagai mana cara membuat aplikasi chat sederhana yang hanya melibatkan saya dan Anda :D, dan bagai mana jika ada teman saya yang lain ikut nimbrung ?</p>

<p>Jelas ini tidak bisa karena 1 winsock hanya bisa menangani 1 port, trus bagaimana jika kita ingin teman kita yang lain bisa konek di port yang sama dan hanya menggunakan 1 winsock? Jawabannya sederhana objek winsocknya kita jadikan array.</p>

<!-- more -->


<p>Oke, masukkan objek winsock ke form kemudian untuk menjadikannya sebagai objek array kita cukup mengset properties Index=0, jadi winsock dengan index 0 bertugas untuk mengecek permintaan koneksi masuk dan mengalokasikannya kepada yang berhak :) dan tentu saja untuk melakukan hal ini harus dalam mode mendengarkan/Listen</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Form_Load()
</span><span class='line'>    With Winsock1(0)
</span><span class='line'>        .Close
</span><span class='line'>        .LocalPort = 11111 &lsquo;nilai port ini bisa diganti
</span><span class='line'>        .Listen
</span><span class='line'>    End With
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Ketika ada permintaan koneksi di port 11111, kita harus menambahkan objek winsock baru untuk menerima permintaan koneksi tersebut dan karena objek winsock yang baru tidak kita set properties LocalPortnya otomatis windows yang akan memberikan nilai Port secara acak.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Winsock1_ConnectionRequest(Index As Integer, ByVal requestID As Long)
</span><span class='line'>    &lsquo;we should only be getting connection requests from
</span><span class='line'>    'Index 0 because thats the only one that is listening&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>'load a new winsock
</span><span class='line'>Load Winsock1(Winsock1.UBound + 1)
</span><span class='line'>
</span><span class='line'>'accept the incoming connection on our new control
</span><span class='line'>Winsock1(Winsock1.UBound).Accept requestID
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Fungsi <strong>UBound</strong> digunakan untuk mendapatkan nilai index terakhir dari objek array, jadi untuk mengetahui berapa jumlah objek arraynya kita cukup memanggil fungsi <strong>UBound + 1</strong>.</p>

<p>Solusi menggunakan winsock array diatas masih mempunyai sedikit masalah, misalkan kita sudah mempunyai 5 koneksi di port 11111 ini artinya kita sudah mempunyai 6 objek winsock yang aktif, index 0 dalam mode mendengarkan/Listen, dan 1 sampai 5 konek ke klien.</p>

<p>Apa yang terjadi jika 3 klien tidak terkoneksi lagi? Sebenarnya sih enggak terlalu bermasalah, masalahnya adalah jika ada klien lain yang konek ke server otomatis objek winsock baru ditambahkan lagi untuk menerima koneksi yang baru, padahal ada 3 objek winsock yang sedang nganggur/idle.</p>

<p>Bayangkan jika kita diminta untuk membuat aplikasi billing warnet dengan 100 klien, ada 50 klien yang sudah disconnect kemudian ada 50 klien lagi yang baru konek. Ini artinya kita mempunyai 50 objek winsock nganggur/idle yang jelas-jelas merupakan pemborosan memory dan bagai mana jika hal tersebut terulang lagi, lagi dan lagi.</p>

<p>Bagaimana solusinya? Yaph sebenarnya ini juga gampang, jadi jika ada permintaan koneksi dari klien kita cek dulu ada nggak objek winsock yang idle, kalo ada arahkan agar winsock yang idle tadi untuk menerima koneksi tersebut, jika tidak ada baru kita tambahkan objek winsock yang baru untuk menerima koneksi tersebut sehingga kode sebelumnya harus kita revisi menjadi :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Winsock1_ConnectionRequest(Index As Integer, ByVal requestID As Long)
</span><span class='line'>    Dim i          As Long
</span><span class='line'>    Dim j          As Long&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>On Error GoTo errHandle
</span><span class='line'>
</span><span class='line'>If Index = 0 Then 'ingat yang bertugas untuk mengecek permintaan koneksi adalah objek winsock dengan index = 0
</span><span class='line'>    'ini bagian yang bertugas untuk mengecek winsock yang idle
</span><span class='line'>    For i = 1 To Winsock1.UBound
</span><span class='line'>        If Winsock1(i).State = sckClosed Or Winsock1(i).State = sckClosing Then
</span><span class='line'>            j = i   'var j menampung index winsock yang idle
</span><span class='line'>            Exit For
</span><span class='line'>        End If
</span><span class='line'>    Next i
</span><span class='line'>
</span><span class='line'>    'jika j = 0 berarti semua winsock kepakai, otomatis kita harus menambahkan winsock yang baru
</span><span class='line'>    If j = 0 Then
</span><span class='line'>        Call Load(Winsock1(Winsock1.UBound + 1))
</span><span class='line'>        j = Winsock1.UBound
</span><span class='line'>    End If
</span><span class='line'>
</span><span class='line'>    'terima koneksi yang baru
</span><span class='line'>    With Winsock1(j)
</span><span class='line'>        Call .Close
</span><span class='line'>        Call .Accept(requestID)
</span><span class='line'>    End With
</span><span class='line'>
</span><span class='line'>End If
</span><span class='line'>
</span><span class='line'>Exit Sub
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>errHandle:
</span><span class='line'>    Call Winsock1(0).Close
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Yaph cukup itu saja, contoh programnya bisa didownload di<a href="https://github.com/k4m4r82/AplikasiChat2">sini</a>.</p>

<p>Artikel berikutnya insya Alloh dengan judul <a href="/blog/2010/02/02/belajar-winsock-bagian-4-%E2%80%93-membuat-jaringan-vpn-sendiri/">Belajar Winsock bagian 4 – Membuat jaringan VPN sendiri</a>.</p>

<p>Di artikel tersebut saya sudah tidak membahas penggunaan winsock lagi tetapi artikel tersebut dibutuhkan agar saya bisa menulis artikel terakhir dari 5 seri belajar Winsock ini yang berjudul <a href="/blog/2010/02/04/belajar-winsock-bagian-akhir-%e2%80%93-contoh-kasus-mengakses-data-stok-barang-dari-luar/">Belajar Winsock bagian akhir – Contoh kasus mengakses data stok barang dari luar</a>.</p>

<p>Dan tentunya ini bukan via web (kalo yang ini sudah enggak perlu dibahas lagi) tetapi tetap dengan mengembangkan contoh-contoh program winsock sebelumnya, dan sebagai uji coba untuk komputer server toko yang akan diakses menggunakan speedy sedangkan saya menggunakan starone dan mudah-mudahan saja uji coba ini berhasil :).</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Belajar Winsock Bagian 2 - Membuat Aplikasi Chat Sederhana 1:1]]></title>
    <link href="http://coding4ever.net/blog/2010/01/28/belajar-winsock-bagian-2-membuat-aplikasi-chat-sederhana-11/"/>
    <updated>2010-01-28T14:26:04+07:00</updated>
    <id>http://coding4ever.net/blog/2010/01/28/belajar-winsock-bagian-2-membuat-aplikasi-chat-sederhana-11</id>
    <content type="html"><![CDATA[<p>Setelah memahami <a href="/blog/2010/01/26/belajar-winsock-bagian-1/">properties-properties dasar</a> yang harus disetting untuk membuat aplikasi sederhana menggunakan winsock, pada artikel ke 2 dari 5 seri belajar winsock ini kita akan membuat aplikasi chat sederhana dengan pola 1:1 atau dengan istilah lainnya single connection.</p>

<p>Membuat aplikasi chatting seperti MSN Messenger atau Yahoo Messenger sebenarnya mudah (tapi tidak termasuk saya ya :D) dan kita sudah mempelajari bagaimana membuat koneksi sederhana menggunakan winsock, selanjutnya kita tinggal mengirimkan data menggunakan method <strong>.SendData</strong> dan menghandle data yang diterima melalui event <strong>Winsock_DataArrival</strong>.</p>

<!-- more -->


<p>Contoh penggunaan method SendData :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub cmdSend_Click()
</span><span class='line'>    With Winsock1
</span><span class='line'>        .SendData &ldquo;Belajar Winsock Bagian 2&rdquo;
</span><span class='line'>    End With
</span><span class='line'>    DoEvents
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Pemanggilan fungsi DoEvents untuk memberikan jeda waktu untuk menyelesaikan pengiriman data.</p>

<p>Kode untuk menghandle data yang masuk juga sangat sederhana. Winsock menerima data dan menyimpannya di dalam <a href="http://id.wikipedia.org/wiki/Buffer">buffer</a>. Untuk memanggil data ini, kita tinggal memanggil method <strong>.GetData</strong> dan ingat kita tidak bisa memanggil method ini setiap waktu karena setelah itu buffer otomatis dikosongkan. Jadi waktu yang tepat untuk memanggil method ini adalah pada saat event <strong>Winsock_DataArrival</strong> dijalankan.</p>

<p>Contoh penggunaan method GetData :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Private Sub Winsock1_DataArrival(ByVal bytesTotal As Long)
</span><span class='line'>    Dim strData As String&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>Call Winsock1.GetData(strData)
</span><span class='line'>MsgBox strData
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Oke, sampai disini kita sudah mengetahui dasar-dasar untuk membuat aplikasi chat sederhana dan untuk mendemokan ini kita akan membutuhkan 2 program kita sebut saja klien dan server. Adapun persiapan untuk aplikasi server/klien :</p>

<ol>
<li><p> Objek Winsock</p></li>
<li><p> Label</p></li>
<li><p> 2 TextBox</p></li>
<li><p> CommandButton</p></li>
</ol>


<p>Source code lengkap aplikasi server :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Option Explicit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub cmdSend_Click()
</span><span class='line'>    Winsock1.SendData txtChat.Text
</span><span class='line'>    DoEvents&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>txtMain.Text = txtMain.Text &amp; vbCrLf &amp; txtChat.Text
</span><span class='line'>txtChat.Text = ""
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Form_Load()
</span><span class='line'>    Winsock1.LocalPort = 11111
</span><span class='line'>    Winsock1.Listen
</span><span class='line'>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Winsock1_ConnectionRequest(ByVal requestID As Long)
</span><span class='line'>    &lsquo;reset the socket, and accept the new connection
</span><span class='line'>    Winsock1.Close
</span><span class='line'>    Winsock1.Accept requestID
</span><span class='line'>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Winsock1_DataArrival(ByVal bytesTotal As Long)
</span><span class='line'>    Dim strData As String&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>'get the data and display it in the textbox
</span><span class='line'>Winsock1.GetData strData
</span><span class='line'>txtMain.Text = txtMain.Text &amp; vbCrLf &amp; strData
</span><span class='line'>txtMain.SelStart = Len(txtMain.Text)
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Aplikasi server tinggal duduk maniz :D dan menunggu koneksi yang masuk.</p>

<p>Source code lengkap aplikasi klien :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Option Explicit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Form_Load()
</span><span class='line'>    &lsquo;set up the Winsock1 to connect to the local computer
</span><span class='line'>    Winsock1.RemoteHost = &ldquo;127.0.0.1&rdquo;
</span><span class='line'>    Winsock1.RemotePort = 11111
</span><span class='line'>    Winsock1.Connect
</span><span class='line'>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub cmdSend_Click()
</span><span class='line'>    &lsquo;send the data thats in the text box and
</span><span class='line'>    'clear it to prepare for the next chat message
</span><span class='line'>    Winsock1.SendData txtChat.Text
</span><span class='line'>    DoEvents&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>txtMain.Text = txtMain.Text &amp; vbCrLf &amp; txtChat.Text
</span><span class='line'>txtChat.Text = ""
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Winsock1_Connect()
</span><span class='line'>    &lsquo;we are connected!
</span><span class='line'>    MsgBox &ldquo;Connected&rdquo;
</span><span class='line'>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Winsock1_DataArrival(ByVal bytesTotal As Long)
</span><span class='line'>    Dim strData As String&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>' get the data from the socket
</span><span class='line'>Winsock1.GetData strData
</span><span class='line'>' display it in the textbox
</span><span class='line'>txtMain.Text = txtMain.Text &amp; vbCrLf &amp; strData
</span><span class='line'>' scroll the box down
</span><span class='line'>txtMain.SelStart = Len(txtMain.Text)
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>End Sub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Private Sub Winsock1_Error(ByVal Number As Integer, Description As String, ByVal Scode As Long, ByVal Source As String, ByVal HelpFile As String, ByVal HelpContext As Long, CancelDisplay As Boolean)
</span><span class='line'>    &lsquo; an error has occured somewhere, so let the user know
</span><span class='line'>    MsgBox &ldquo;Error: &rdquo; &amp; Description
</span><span class='line'>    &rsquo; close the socket, ready to go again
</span><span class='line'>    Winsock1.Close
</span><span class='line'>End Sub</span></code></pre></td></tr></table></div></figure></p>

<p>Sample program bisa didownload di<a href="https://github.com/k4m4r82/AplikasiChat1">sini</a> dan artikel berikutnya insya Alloh dengan judul <a href="/blog/2010/01/30/belajar-winsock-bagian-3-%e2%80%93-multiple-connection/">Belajar Winsock bagian 3 – Multiple Connection</a> segera menyusul.</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
</feed>
