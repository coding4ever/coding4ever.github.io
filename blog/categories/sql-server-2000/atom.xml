<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Sql Server 2000 | Coding4ever's Blog]]></title>
  <link href="http://coding4ever.net/blog/categories/sql-server-2000/atom.xml" rel="self"/>
  <link href="http://coding4ever.net/"/>
  <updated>2016-07-28T12:45:26+07:00</updated>
  <id>http://coding4ever.net/</id>
  <author>
    <name><![CDATA[Admin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SELECT SCOPE_IDENTITY(), SELECT LAST_INSERT_ID() Dan RETURNING PK]]></title>
    <link href="http://coding4ever.net/blog/2011/02/27/select-scope_identity-select-last_insert_id-dan-returning-pk/"/>
    <updated>2011-02-27T13:51:22+07:00</updated>
    <id>http://coding4ever.net/blog/2011/02/27/select-scope_identity-select-last_insert_id-dan-returning-pk</id>
    <content type="html"><![CDATA[<p>Yuph kali ini kita akan membahas fungsi menarik (SELECT SCOPE_IDENTITY(), SELECT LAST_INSERT_ID() dan RETURNING PK) yang dimiliki oleh database2x terkenal seperti SQL Server, MySQL dan Firebird.</p>

<p>Dari nama fungsinya kita bisa menebak kegunaan dari fungsi diatas yaitu untuk mendapatkan nilai ID terakhir (biasanya bertipe angka) yang diinputkan.</p>

<p>Saya dan mungkin Anda biasanya dalam merancang tabel untuk selalu menambahkan field ID dengan attribut IDENTITY/AUTONUMBER dan sekaligus dijadikan sebagai PRIMARY KEY.</p>

<p>Tentunya hal ini kita lakukan untuk mempermudah dalam proses manipulasi data (edit dan delete).</p>

<p>Contoh beberapa tabel yang biasanya menggunakan field ID untuk PRIMARY KEY dan sekaligus diset dengan attribut IDENTITY/AUTONUMBER</p>

<!-- more -->


<p><a href="http://coding4ever.files.wordpress.com/2011/02/table1.png"><img src="http://coding4ever.files.wordpress.com/2011/02/table1.png?w=300" alt="" /></a></p>

<p>Bagi yang males membaca referensi (termasuk sy :D) biasa menuliskan kode berikut untuk mengINSERTkan dan mendapatkan nilai ID yang terakhir, kita ambil contoh tabel provinsi.</p>

<p>{% codeblock lang:vbnet %}
Private Sub btnInsert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnInsert.Click
    Dim lastID As Long = 0</p>

<pre><code>' langkah 1 - menambahkan data
strSql = "INSERT INTO provinsi (keterangan) VALUES (@1)"
Using cmd As New SqlClient.SqlCommand(strSql, conn)
    With cmd
        .Parameters.Clear()
        .Parameters.AddWithValue("@1", "Riau")

        .ExecuteNonQuery()
    End With
End Using

' langkah 2 - mengambil id terakhir dg memanfaatkan fungsi MAX
strSql = "SELECT MAX(id) FROM provinsi"
Using cmd As New SqlClient.SqlCommand(strSql, conn)
    lastID = Convert.ToInt32(cmd.ExecuteScalar())
End Using

' tampilkan ID terakhir
MessageBox.Show("Last ID : " &amp; lastID.ToString())
</code></pre>

<p>End Sub
{% endcodeblock %}</p>

<p>Sekarang kita lihat bedanya jika memanfaatkan fungsi SELECT SCOPE_IDENTITY().</p>

<p>{% codeblock lang:vbnet %}
Private Sub btnInsert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnInsert.Click
    Dim lastID As Long = 0</p>

<pre><code>strSql = "INSERT INTO provinsi (keterangan) VALUES (@1) SELECT SCOPE_IDENTITY()" ' ada tambahan SELECT SCOPE_IDENTITY()
Using cmd As New SqlClient.SqlCommand(strSql, conn)
    With cmd
        .Parameters.Clear()
        .Parameters.AddWithValue("@1", "Riau")

        lastID = Convert.ToInt32(.ExecuteScalar())
    End With
End Using

MessageBox.Show ("Last ID : " &amp; lastID.ToString())
</code></pre>

<p>End Sub
{% endcodeblock %}</p>

<p>Gimana lebih simple kan ? :)</p>

<p>Oke sekarang kita lihat kode untuk MySQL(SELECT LAST_INSERT_ID) dan Firebird (RETURN KOLOM_PK).</p>

<p>{% codeblock lang:vbnet %}
&lsquo; MySQL
Private Sub btnInsert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnInsert.Click
    Dim lastID As Long = 0</p>

<pre><code>strSql = "INSERT INTO provinsi (keterangan) VALUES (@1); SELECT LAST_INSERT_ID()"
Using cmd As New MySqlClient.MySqlCommand(strSql, conn)
    With cmd
        .Parameters.Clear()
        .Parameters.AddWithValue("@1", "Riau")

        lastID = Convert.ToInt32(.ExecuteScalar())
    End With
End Using

MessageBox.Show ("Last ID : " &amp; lastID.ToString())
</code></pre>

<p>End Sub</p>

<p>&lsquo; Firebird
Private Sub btnInsert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnInsert.Click
    Dim lastID As Long = 0</p>

<pre><code>strSql = "INSERT INTO provinsi (keterangan) VALUES (@1) RETURNING ID" ' ID -&gt; kolom primary key
Using cmd As New FirebirdClient.FbCommand(strSql, conn)
    With cmd
        .Parameters.Clear()
        .Parameters.AddWithValue("@1", "Riau")

        lastID = Convert.ToInt32(.ExecuteScalar())
    End With
End Using

MessageBox.Show ("Last ID : " &amp; lastID.ToString())
</code></pre>

<p>End Sub
{% endcodeblock %}</p>

<p>Untuk bisa mengakses database MySQL dan Firebird di Visual Basic .NET kita harus menginstall <a href="http://dev.mysql.com/downloads/connector/net/">MySQL Connector/Net</a> dan <a href="http://firebirdsql.org/index.php?op=files&amp;id=netprovider">Firebird ADO.NET Data Provider</a>.</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
</feed>
