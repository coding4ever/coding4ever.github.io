<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Sms Gateway | Coding4ever's Blog]]></title>
  <link href="http://coding4ever.net/blog/categories/sms-gateway/atom.xml" rel="self"/>
  <link href="http://coding4ever.net/"/>
  <updated>2018-09-28T05:21:35+07:00</updated>
  <id>http://coding4ever.net/</id>
  <author>
    <name><![CDATA[Admin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Membuat Service SMS Gateway Untuk Engine Gammu]]></title>
    <link href="http://coding4ever.net/blog/2017/08/22/membuat-service-sms-gateway-untuk-engine-gammu/"/>
    <updated>2017-08-22T15:59:07+07:00</updated>
    <id>http://coding4ever.net/blog/2017/08/22/membuat-service-sms-gateway-untuk-engine-gammu</id>
    <content type="html"><![CDATA[<p><img class="left <a" src="href="https://coding4ever.files.wordpress.com/2017/08/gammu.png">https://coding4ever.files.wordpress.com/2017/08/gammu.png</a>&#8221; width=&#8221;100&#8221; height=&#8221;100&#8221;>Pasti udah pada tau kan apa itu <a href="https://wammu.eu/gammu/">Gammu</a> ? Klo enggak ya keterlaluan he he. Itu loh engine yang biasa digunakan untuk mengirim dan menerima sms dan biasanya sering digunakan untuk membuat sms gateway.</p>

<p>Di postingan ini saya tidak akan membahas bagaimana cara instalasi <a href="https://wammu.eu/gammu/">Gammu</a>, konfigurasi dan database yang digunakan. Jadi saya mengasumsikan bahwa service Gammu Anda (GammuSMSD) sudah berjalan dengan baik, dengan kata lain jika ada sms masuk ke nomor yang Anda gunakan sebagai sms center, maka service <a href="https://wammu.eu/gammu/">Gammu</a> otomatis akan meng-INSERT-kan sms tersebut ke tabel inbox.</p>

<!-- more -->


<h3>Struktur Tabel Gammu</h3>

<p>Sebelum kita lanjut bagaimana membuat windows service untuk engine <a href="https://wammu.eu/gammu/">Gammu</a> ada baiknya kita melihat dulu struktur tabel <a href="https://wammu.eu/gammu/">Gammu</a> secara menyeluruh.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-01.png">https://coding4ever.files.wordpress.com/2017/08/20170822-01.png</a>&#8221;></p>

<p>Dari keenam tabel di atas, kita cukup fokus di 3 tabel utama yaitu <code>inbox</code>, <code>outbox</code> dan <code>outbox_multipart</code>. Tabel inbox otomatis terisi, jika ada sama masuk tentunya dengan syarat service Gammu Anda (GammuSMSD) sudah berjalan dengan baik. Di tabel inbox ini juga sudah ada field dengan nama Processed yang bisa kita gunakan sebagai flag/penanda sms yang sudah diproses.</p>

<p>Nah jika ada sms yang mau dikirim, tinggal kita INSERT-kan datanya secara manual ke tabel outbox. Dan jika smsnya panjang (lebih dari 160 karakter), smsnya harus kita pecah menjadi 2, 3, dst sesuai dengan jumlah karakter yang mau dikirim. Setelah dipecah, sms pertama masuk ke tabel outbox, dan sisanya masuk ke tabel outbox_multipart.</p>

<p>Untuk informasi lebih lanjut tentang struktur database <a href="https://wammu.eu/gammu/">Gammu</a> bisa Anda cek di <a href="https://wammu.eu/docs/manual/smsd/tables.html">sini</a>.</p>

<h3>Konfigurasi Gammu</h3>

<p>Untuk konfigurasi gammu ada dua file yang harus kita edit nilainya yaitu file <code>smsdrc</code> dan <code>gammurc</code>. File ini biasanya ada di folder <code>Instalasi Gammu\share\doc\gammu\examples\config</code> trus kita copykan ke folder <code>Instalasi Gammu\bin</code>. Berikut adalah contoh konfigurasi gammu yang saya gunakan.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>konfigurasi file gammurc&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>[gammu]
</span><span class='line'>device = com3:
</span><span class='line'>connection = at115200</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>konfigurasi file smsdrc&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>[gammu]
</span><span class='line'>device = com3:
</span><span class='line'>connection = at115200&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[smsd]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>SMSD service to use, one of FILES, MYSQL, PGSQL, DBI&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>service = SQL&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>File (or stderr, syslog, eventlog) where information will be logged&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>logfile = C:\gammu\log\gammu.log&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Amount of information being logged, each bit mean one level&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>debuglevel = 255&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>How many seconds should SMSD wait after there is no message in outbox before scanning it again. Default is 30.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>commtimeout = 1&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Shows how many seconds SMSD should wait for network answer during sending sms. If nothing happen during this time, sms will be resent. Default is 30.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>sendtimeout = 10&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Phone communication settings&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>checksecurity = 0
</span><span class='line'>CheckBattery = 0&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Database backends congfiguration&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user = root
</span><span class='line'>password = rahasia
</span><span class='line'>host = gammuodbc&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>pc can also contain port or socket path after colon (eg. localhost:/path/to/socket)&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>database = db_gammu&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>DBI configuration&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>driver = odbc&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Possible values: mysql, pgsql, sqlite, mssql (Microsoft SQL Server), access (Microsoft Access), oracle&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>ref: &lt;a href="https://wammu.eu/docs/manual/smsd/config.html#gammu-smsdrc">https://wammu.eu/docs/manual/smsd/config.html#gammu-smsdrc&lt;/a>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>sql = mysql</span></code></pre></td></tr></table></div></figure></p>

<p>Coba perhatikan konfigurasi pada file <code>smsdrc</code> di atas terutama di bagian <code>host</code>, nilainya kita isikan dengan nama ODBC yang terhubung ke database gammu, dan untuk membuat ODBCnya kita gunakan fasilitas ODBC Data Source.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-02.png">https://coding4ever.files.wordpress.com/2017/08/20170822-02.png</a>&#8221;></p>

<p>Untuk menambahkan ODBC di atas, sebelumnya kita harus menginstall terlebih dulu MySQL Connector/ODBC.</p>

<h3>Environment Testing dan Development Tool yang Digunakan</h3>

<ul>
<li>Windows 7 Pro 64 bit</li>
<li>Visual Studio Community 2013 – untuk bahasa yang digunakan C#</li>
<li>Tipe aplikasi – Windows Service</li>
<li>Micro ORM <a href="/blog/categories/dapper-net/">Dapper.NET</a></li>
<li>Gammu-1.38.4-Windows-64bit</li>
<li>Database SQLite – untuk menyimpan data siswa, mata pelajaran dan nilai</li>
<li>Database MySQL v5.5.45 – untuk menyimpan data gammu</li>
<li>MySQL Connector/ODBC v5.3.9</li>
<li>Modem Wavecom M1306B</li>
</ul>


<p>Kok menggunakan Connector/ODBC ? Iya karena Gammu v1.38.4 sudah mendukung koneksi menggunakan ODBC. Jadi selain MySQL, dengan menggunakan ODBC dukungan databasenya jadi lebih banyak seperti PostgreSQL, SQLite, Oracle, MS SQL Server dan MS Access.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-03.png">https://coding4ever.files.wordpress.com/2017/08/20170822-03.png</a>&#8221;></p>

<h3>Contoh Kasus</h3>

<p>Untuk contoh kasusnya kita akan membuat service sms gateway untuk request data yang berhubungan dengan siswa seperti data pribadi, mata pelajaran dan nilai. Service sms gateway ini akan terhubung ke dua database yaitu database gammu yang tersimpan di MySQL dan database nilai yang tersimpan di SQLite. Sms gateway ini mempunyai beberapa format request data yaitu:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CEKMP                 # request data mata pelajaran
</span><span class='line'>CEKSISWA#NIS           # request data siswa
</span><span class='line'>CEKNILAI#NIS#&lt;KODE MP> # request data nilai, kode mp optional</span></code></pre></td></tr></table></div></figure></p>

<p>Untuk data siswa, mata pelajaran dan nilainya disimpan menggunakan database SQLite.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-04.png">https://coding4ever.files.wordpress.com/2017/08/20170822-04.png</a>&#8221;></p>

<h3>Project SMS Gateway</h3>

<p>Project SMS Gateway ini dibangun dengan menggunakan <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">konsep separation  of  concern</a> atau pemisahan kode program berdasarkan fungsinya. Semua kode untuk akses database harus dipisahkan dengan kode untuk pengaturan user inteface. Hal ini memungkinkan kode akses database yang dibuat untuk aplikasi desktop, dengan mudah digunakan untuk aplikasi lainnya seperti web, console atau windows service. Selain itu penerapan konsep <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation  of  concern</a> secara disiplin, dapat menghasilkan kode program yang dapat dites secara otomatis menggunakan tool <a href="/blog/2016/07/20/unit-testing-menggunakan-nunit/">Unit Testing</a>.</p>

<p>Untuk urusan kode akses database, project ini menggunakan pattern/pola <a href="/blog/2016/02/22/repository-pattern/">Repository Pattern</a> yang berisi semua kode untuk mengakses database. Semua kode yang sepesifik terhadap implementasi akses database berhenti di sini, lapisan lebih atas tidak boleh tahu bagaimana akses database diterapkan, apakah menggunakan ADO.NET murni (raw ADO.NET) atau menggunakan tool ORM/Micro ORM seperti <a href="/blog/categories/dapper-net/">Dapper.NET</a>, <a href="/blog/categories/entity-framework/">Entity Framework</a> atau NHibernate. Lapisan lainya hanya perlu tahu fungsionalitas dari suatu method di dalam class Repository, tidak perlu tahu bagimana method tersebut diimplementasikan.</p>

<p>Idealnya secara logic, arsitektur aplikasi yang kita gunakan seperti berikut:</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-05.png">https://coding4ever.files.wordpress.com/2017/08/20170822-05.png</a>&#8221;></p>

<p>Tetapi untuk menyederhanakan pembahasan business logic layer bisa kita gabung ke presentation layer, sehingga arsitekturnya menjadi seperti berikut:</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-06.png">https://coding4ever.files.wordpress.com/2017/08/20170822-06.png</a>&#8221;></p>

<p>Nah untuk contoh project SMS Gateway ini menggunakan arsitektur yang kedua.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-07.png">https://coding4ever.files.wordpress.com/2017/08/20170822-07.png</a>&#8221;></p>

<p>Yang pertama adalah project <code>WindowsServiceGammu.Model</code>. Project ini bertipe <code>Class Library</code> yang berisi class model/entity yang merupakan representasi dari sebuah table. Jadi kalo kita ingin menerapkan konsep OOP dalam pemrograman database maka class-class model/entity ini wajib kita gunakan.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-08.png">https://coding4ever.files.wordpress.com/2017/08/20170822-08.png</a>&#8221;></p>

<p>Berikutnya adalah project <code>WindowsServiceGammu.Repository</code>. Project ini bertipe <code>Class Library</code> yang berisi class-class repository yang bertugas untuk menangani operasi CRUD. Biasanya untuk masing-masing class model/entity kita buatkan class repositorynya.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-09.png">https://coding4ever.files.wordpress.com/2017/08/20170822-09.png</a>&#8221;></p>

<p>Pada gambar di atas saya menggunakan dua class context yaitu <a href="https://github.com/k4m4r82/gammu-sms-gateway/blob/master/src/WindowsServiceGammu.Repository/Context/MySqlContext.cs">MySqlContext</a> dan <a href="https://github.com/k4m4r82/gammu-sms-gateway/blob/master/src/WindowsServiceGammu.Repository/Context/SQLiteContext.cs">SQLiteContext</a>. Class context adalah class yang bertanggung jawab untuk berinteraksi secara langsung dengan database. Jadi class contextlah yang bertugas untuk membuat koneksi, menjalankan perintah sql seperti insert, update, delete dan select atau objek database seperti store procedure dan function. Selain class context juga ada class-class repository yang bertugas untuk menangani operasi CRUD. Berikut adalah contoh class repository untuk class <a href="https://github.com/k4m4r82/gammu-sms-gateway/blob/master/src/WindowsServiceGammu.Repository/SiswaRepository.cs">SiswaRepository</a> dan <a href="https://github.com/k4m4r82/gammu-sms-gateway/blob/master/src/WindowsServiceGammu.Repository/GammuRepository.cs">GammuRepository</a>.</p>

<p><div><script src='https://gist.github.com/6398e259ef86dcf1a3386a2e3cd55215.js'></script>
<noscript><pre><code>using Dapper;
using log4net;
using WindowsServiceGammu.Model;

namespace WindowsServiceGammu.Repository
{
    public interface ISiswaRepository
    {
        Siswa GetByNIS(string nis);
    }

    public class SiswaRepository : ISiswaRepository
    {
        private IDapperContext _context;
        private ILog _log;

        public SiswaRepository(IDapperContext context, ILog log)
        {
            this._context = context;
            this._log = log;
        }

        public Siswa GetByNIS(string nis)
        {
            Siswa siswa = null;

            try
            {
                var sql = @&quot;select nis, nama 
                            from siswa 
                            where nis = @nis&quot;;

                siswa = _context.db.QuerySingleOrDefault&lt;Siswa&gt;(sql, new { nis });
            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
            }

            return siswa;   
        }
    }
}</code></pre></noscript></div>
</p>

<p><div><script src='https://gist.github.com/e7f4273deeec9753254b46b8a830fa5d.js'></script>
<noscript><pre><code>using Dapper;
using log4net;
using WindowsServiceGammu.Model.Gammu;

namespace WindowsServiceGammu.Repository
{
    public interface IGammuRepository
    {
        /// &lt;summary&gt;
        /// Method untuk membaca data sms di tabel inbox yang belum diproses
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        IList&lt;Inbox&gt; ReadInbox();

        /// &lt;summary&gt;
        /// Method untuk mengupdate status inbox menjadi sudah diproses
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;inboxId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        int UpdateInbox(int inboxId);

        /// &lt;summary&gt;
        /// Method untuk menyimpan data sms yang akan dikirim ke tabel outbox
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        int SaveOutbox(Outbox obj);

        /// &lt;summary&gt;
        /// Method untuk menyimpan data sms ke 2, 3, dst ke tabel outbox_multipart, jika data sms lebih dari 160 karakter
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        int SaveOutboxMultipart(OutboxMultipart obj);
    }

    public class GammuRepository : IGammuRepository
    {
        private IDapperContext _context;
        private ILog _log;

        public GammuRepository(IDapperContext context, ILog log)
        {
            this._context = context;
            this._log = log;
        }

        public IList&lt;Inbox&gt; ReadInbox()
        {
            IList&lt;Inbox&gt; listOfSMS = new List&lt;Inbox&gt;();

            try
            {
                var sql = @&quot;SELECT `ID`, `UDH`, `SenderNumber`, `TextDecoded`, `ReceivingDateTime`
                            FROM inbox 
                            WHERE Processed = &#39;false&#39;
                            ORDER BY ReceivingDateTime&quot;;

                listOfSMS = _context.db.Query&lt;Inbox&gt;(sql)
                                              .ToList();

            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
            }

            return listOfSMS;
        }

        public int UpdateInbox(int inboxId)
        {
            var result = 0;

            try
            {
                var sql = @&quot;UPDATE inbox SET Processed = &#39;true&#39; 
                            WHERE id = @inboxId&quot;;
                result = _context.db.Execute(sql, new { inboxId });
            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
            }

            return result;
        }

        public int SaveOutbox(Outbox obj)
        {
            var result = 0;

            try
            {
                var sql = @&quot;INSERT INTO outbox (DestinationNumber, UDH, TextDecoded, MultiPart, CreatorID)
                            VALUES (@DestinationNumber, @UDH, @TextDecoded, @MultiPart, &#39;Gammu&#39;)&quot;;
                result = _context.db.Execute(sql, obj);

                if (result &gt; 0)
                {
                    sql = @&quot;SELECT CONVERT(LAST_INSERT_ID(), SIGNED INTEGER) AS ID&quot;;
                    obj.Id = _context.db.QuerySingleOrDefault&lt;int&gt;(sql);
                }
            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
            }

            return result;
        }

        public int SaveOutboxMultipart(OutboxMultipart obj)
        {
            var result = 0;

            try
            {
                var sql = @&quot;INSERT INTO outbox_multipart(ID, UDH, TextDecoded, SequencePosition)
                            VALUES (@ID, @UDH, @TextDecoded, SequencePosition)&quot;;
                result = _context.db.Execute(sql, obj);
            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
            }

            return result;
        }
    }
}</code></pre></noscript></div>
</p>

<p>Untuk class repository lainnya bisa Anda cek di <a href="https://github.com/k4m4r82/gammu-sms-gateway/tree/master/src/WindowsServiceGammu.Repository">sini</a>.</p>

<p>Dan yang terakhir adalah project <code>WindowsServiceGammu.Service</code> yang bertipe <code>Windows Service</code>. Project ini tidak bisa dijalankan secara langsung seperti halnya project dengan tipe Console atau Windows Form, tapi harus didaftarkan terlebih dahulu ke Windows Service.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-10.png">https://coding4ever.files.wordpress.com/2017/08/20170822-10.png</a>&#8221;></p>

<p>Project ini hanya memanggil class-class model atau repository yang sudah ada.</p>

<p>Ada dua class utama yang digunakan oleh project ini yang pertama yaitu class <code>MainService</code> yang merupakan turunan dari class ServiceBase. Class ServiceBase adalah class bawaan .NET Framework yang merupakan class dasar agar sebuah aplikasi bisa di register/menjadi bagian dari aplikasi service (Windows Service).</p>

<p><div><script src='https://gist.github.com/1713b5f3b53013a0cf2e0e5c199875cf.js'></script>
<noscript><pre><code>using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Diagnostics;
using System.Linq;
using System.ServiceProcess;
using System.Text;

using log4net;

namespace WindowsServiceGammu.Service
{
    public partial class MainService : ServiceBase
    {
        private readonly List&lt;TaskBase&gt; _listOfTask;
        private readonly ILog _log;
        private const int RefreshInterval = 1000; // In milliseconds

        public MainService()
        {
            InitializeComponent();
            _log = Program.log;

            // Add in this list the tasks to run periodically.
            // Tasks frequencies are set in the corresponding classes.
            _listOfTask = new List&lt;TaskBase&gt;
            {
                new SMSGatewayTask(RefreshInterval, _log)
            };
        }

        protected override void OnStart(string[] args)
        {
            try
            {
                _log.Info(&quot;Services started ...&quot;);
                _listOfTask.ForEach(t =&gt; t.StartService());
            }
            catch (Exception ex)
            {
                _log.Error(&quot;Error:&quot;, ex);
                Stop();
            }
        }

        protected override void OnStop()
        {
            _log.Info(&quot;Services stoped ...&quot;);
            _listOfTask.ForEach(t =&gt; t.StopService());
        }
    }
}</code></pre></noscript></div>
</p>

<p>Berikutnya adalah class <code>SMSGatewayTask</code> yang bertugas untuk membaca tabel inbox-nya gammu, memvalidasi perintah yang ada dan mengenerate pesan balasan dan kemudian menyimpannya ke tabel outbox. Semua aktivitas membaca dan menyimpan kembali ke database ini dibantu oleh class-class repository.</p>

<p><div><script src='https://gist.github.com/5d25b7f4ab056635fc915bb1404cf909.js'></script>
<noscript><pre><code>using log4net;
using WindowsServiceGammu.Model;
using WindowsServiceGammu.Model.Gammu;
using WindowsServiceGammu.Repository;

namespace WindowsServiceGammu.Service
{
    public class SMSGatewayTask : TaskBase
    {
        private ILog _log;

        public SMSGatewayTask(int refreshInterval, ILog log)
            : base(refreshInterval) // In milliseconds
        {
            _log = log;
        }        

        protected override void ExecTask()
        {
            using (IDapperContext mysqlContext = new MySqlContext())
            {
                IGammuRepository gammuRepo = new GammuRepository(mysqlContext, _log);
                var listOfInbox = gammuRepo.ReadInbox();

                foreach (var inbox in listOfInbox)
                {                    
                    var phoneNumber = inbox.SenderNumber;

                    if (phoneNumber.Substring(0, 3) == &quot;+62&quot;)
                    {
                        var keyword = inbox.TextDecoded;
                        var prefix = keyword;
                        var msg = string.Empty;

                        if (keyword.IndexOf(&quot;#&quot;) &gt;= 0) // karakter # -&gt; separator keyword
                        {
                            var nis = string.Empty;
                            var kodeMP = string.Empty;

                            var arrKeyword = keyword.Split(&#39;#&#39;);
                            prefix = arrKeyword[0];

                            switch (prefix.ToUpper())
                            {
                                case &quot;CEKSISWA&quot;: // FORMAT PERINTAH: CEKSISWA#NIS
                                    nis = arrKeyword[1]; // nis di ambil dari parameter pertama
                                    msg = GetBalasanCekSiswa(nis);

                                    break;

                                case &quot;CEKNILAI&quot;: // FORMAT PERINTAH: CEKNILAI#NIS#&lt;OPTIONAL KODE MP&gt;
                                    nis = arrKeyword[1]; // nis di ambil dari parameter pertama
                                    kodeMP = arrKeyword.Count() &gt; 2 ? arrKeyword[2] : string.Empty;

                                    msg = GetBalasanCekNilai(nis, kodeMP);
                                    break;

                                default:
                                    break;
                            }
                        }
                        else
                        {
                            // FORMAT PERINTAH: CEKMP
                            if (keyword.ToUpper() == &quot;CEKMP&quot;)
                            {
                                msg = GetBalasanCekMP();
                            }
                            else // keyword tidak valid
                            {
                                msg = string.Format(&quot;Keyword {0} tidak terdaftar&quot;, keyword.ToUpper());
                            }
                        }

                        SaveOutbox(msg, inbox, gammuRepo);
                    }                    
                }
            }
        }

        /// &lt;summary&gt;
        /// Method untuk menyimpan pesan yang akan dikirim ke tabel outbox
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;msg&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;inbox&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;gammuRepo&quot;&gt;&lt;/param&gt;
        private void SaveOutbox(string msg, Inbox inbox, IGammuRepository gammuRepo)
        {
            var result = 0;

            // insert ke tabel outbox
            var jumlahSMS = (int)Math.Ceiling((double)msg.Length / 160);

            if (jumlahSMS &gt; 1) // balasan sms &gt; 160 karakter, sms dipecah sebelum dikirim
            {
                var listSms = msg.SplitByLength(153)
                                 .ToList();

                var smsKe = 1;
                var outboxID = 0;
                foreach (var sms in listSms)
                {
                    var udh = inbox.UDH;

                    if (udh.Length == 0)
                    {
                        udh = string.Format(&quot;050003A7{0:00}{1:00}&quot;, listSms.Count, smsKe);
                    }
                    else
                    {
                        udh = inbox.UDH.Substring(0, inbox.UDH.Length - 4);
                        udh = string.Format(&quot;{0}{1:00}{2:00}&quot;, udh, listSms.Count, smsKe);
                    }

                    if (smsKe == 1)
                    {
                        var outbox = new Outbox
                        {
                            DestinationNumber = inbox.SenderNumber,
                            UDH = udh,
                            TextDecoded = sms,
                            MultiPart = &quot;true&quot;
                        };

                        result = gammuRepo.SaveOutbox(outbox);
                        if (result &gt; 0)
                        {
                            outboxID = outbox.Id;
                        }
                    }
                    else // sms ke 2, 3, dst, simpan ke tabel outbox_multipart
                    {
                        var outboxMultipart = new OutboxMultipart
                        {
                            Id = outboxID,
                            UDH = udh,
                            TextDecoded = sms,
                            SequencePosition = smsKe
                        };

                        result = gammuRepo.SaveOutboxMultipart(outboxMultipart);
                    }

                    smsKe++;
                }
            }
            else // balasan sms &lt;= 160 karakter
            {
                var outbox = new Outbox
                {
                    DestinationNumber = inbox.SenderNumber,
                    UDH = string.Empty,
                    TextDecoded = msg,
                    MultiPart = &quot;false&quot;
                };

                result = gammuRepo.SaveOutbox(outbox);
            }

            if (result &gt; 0)
            {
                // update status pesan di inbox menjadi sudah diproses
                result = gammuRepo.UpdateInbox(inbox.Id);
            }
        }

        /// &lt;summary&gt;
        /// Method untuk mengenerate pesan balasan untuk keyword: CEKSISWA#NIS
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nis&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetBalasanCekSiswa(string nis)
        {
            var msg = string.Empty;

            using (IDapperContext sqliteContext = new SQLiteContext())
            {
                ISiswaRepository siswaRepo = new SiswaRepository(sqliteContext, _log);
                var siswa = siswaRepo.GetByNIS(nis);

                if (siswa == null)
                {
                    msg = string.Format(&quot;NIS: {0} tidak ditemukan&quot;, nis);
                }
                else
                {
                    msg = string.Format(&quot;NIS: {0}\nNAMA: {1}&quot;, siswa.nis, siswa.nama);
                }
            }

            return msg;
        }

        /// &lt;summary&gt;
        /// Method untuk mengenerate pesan balasan untuk keyword: CEKNILAI#NIS#&lt;OPTIONAL KODE MP&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nis&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;kodeMP&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetBalasanCekNilai(string nis, string kodeMP)
        {
            var msg = string.Empty;

            IList&lt;Nilai&gt; listOfNilai = new List&lt;Nilai&gt;();

            using (IDapperContext sqliteContext = new SQLiteContext())
            {
                ISiswaRepository siswaRepo = new SiswaRepository(sqliteContext, _log);
                var siswa = siswaRepo.GetByNIS(nis);

                if (siswa == null)
                {
                    msg = string.Format(&quot;NIS: {0} tidak ditemukan&quot;, nis);
                }
                else
                {
                    INilaiRepository nilaiRepo = new NilaiRepository(sqliteContext, _log);

                    if (nis.Length &gt; 0 &amp;&amp; kodeMP.Length &gt; 0)
                    {
                        var nilai = nilaiRepo.GetByNIS(nis, kodeMP);
                        listOfNilai.Add(nilai);
                    }
                    else
                    {
                        listOfNilai = nilaiRepo.GetByNIS(nis);
                    }

                    msg = string.Format(&quot;NIS: {0}\nNAMA: {1}\n&quot;, siswa.nis, siswa.nama);
                    msg += &quot;Nilai:\n&quot;;

                    foreach (var nilai in listOfNilai)
                    {
                        msg += string.Format(&quot;{0}: {1}\n&quot;, nilai.kode, nilai.nilai);
                    }
                }
            }

            return msg;
        }

        /// &lt;summary&gt;
        /// Method untuk mengenerate pesan balasan untuk keyword: CEKMP
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetBalasanCekMP()
        {
            var msg = string.Empty;

            using (IDapperContext sqliteContext = new SQLiteContext())
            {
                IMataPelajaranRepository mataPelajaranRepo = new MataPelajaranRepository(sqliteContext, _log);
                var listOfMataPelajaran = mataPelajaranRepo.GetAll();

                msg = string.Empty;
                msg = &quot;kode mata pelajaran:\n&quot;;

                foreach (var mataPelajaran in listOfMataPelajaran)
                {
                    msg += string.Format(&quot;{0}: {1}\n&quot;, mataPelajaran.kode, mataPelajaran.deskripsi);
                }
            }

            return msg;
        }
    }
}</code></pre></noscript></div>
</p>

<h3>Instalasi Windows Service</h3>

<p>Seperti yang sudah saya jelaskan di atas, project dengan tipe Windows Service tidak bisa dijalankan secara langsung seperti halnya project dengan tipe Console atau Windows Form, tapi harus didaftarkan terlebih dahulu ke Windows Service. Untuk mendaftarkannya kita gunakan tool bawaan .NET Framework yaitu InstallUtil.exe.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>install service&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>%WINDIR%\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe WindowsServiceGammu.Service.exe&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>uninstall service&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>%WINDIR%\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe WindowsServiceGammu.Service.exe /u</span></code></pre></td></tr></table></div></figure></p>

<p>Jika berhasil seharusnya service sms gateway yang sudah kita buat akan terdaftar di Windows Service.</p>

<p><img class="center <a" src="href="https://coding4ever.files.wordpress.com/2017/08/20170822-11.png">https://coding4ever.files.wordpress.com/2017/08/20170822-11.png</a>&#8221;></p>

<p>Selamat <a href="https://github.com/k4m4r82/gammu-sms-gateway">MENCOBA</a> :-)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SMS Gateway Edisi .NET Part 1]]></title>
    <link href="http://coding4ever.net/blog/2014/05/10/sms-gateway-edisi-net-part-1/"/>
    <updated>2014-05-10T10:11:25+07:00</updated>
    <id>http://coding4ever.net/blog/2014/05/10/sms-gateway-edisi-net-part-1</id>
    <content type="html"><![CDATA[<p><img class="left <a" src="href="http://coding4ever.files.wordpress.com/2014/05/sms_gateway.png">http://coding4ever.files.wordpress.com/2014/05/sms_gateway.png</a>&#8220;>Postingan pertama di <a href="">domain</a> yang baru :), saya ingin membahas lagi tentang pembuatan aplikasi SMS Gateway. Alasannya sederhana karna salah satu artikel yang paling banyak dibaca di blog ini adalah artikel <a href="/blog/2010/07/12/membuat-sms-gateway-itu-gampang-jangan-dipersulit/">Membuat Sms Gateway Itu Gampang, Jangan Dipersulit !!!</a>.</p>

<p>Jika pada artikel <a href="/blog/2010/07/12/membuat-sms-gateway-itu-gampang-jangan-dipersulit/">Membuat Sms Gateway Itu Gampang, Jangan Dipersulit !!!</a>, kita menggunakan bahasa pemrograman VB 6, untuk postingan kali ini kita akan menggunakan bahasa pemrograman C#.</p>

<!-- more -->


<p>Untuk membaca dan mengirim sms kita akan menggunakan library <a href="http://www.nuget.org/packages/GSMComm/">GSMComm</a>, yang bisa diinstall via <a href="/blog/categories/nuget/">NuGet</a>.</p>

<p>Sebelum lanjut kita lihat dulu fitur dari library <a href="http://www.nuget.org/packages/GSMComm/">GSMComm</a> :</p>

<ul>
<li>Manage SMS messages: Send, read, delete, store, import and export messages, get memory status, get/set SMSC.</li>
<li>Manage the phonebook: Create, find, delete, read, import and export phonebook entries, get memory status.</li>
<li>Manage the phone: Read general info, reset configuration, enter PIN</li>
<li>Supports notifications about new messages as well as forwarding them directly to the application.</li>
<li>Detect phone connection/disconnection.</li>
<li>Other SMS message variants also possible, such as alerts and notifications.</li>
<li>Support for Smart Messaging and related messages to create, locate and recombine concatenated text messages, and also to create operator logo messages.</li>
<li>Logging support with 4 levels to assist in troubleshooting.</li>
<li>Support for GSM 7-bit default alphabet and Unicode for the message text.</li>
<li>Supports some operator functions.</li>
<li>Remoting support for sending SMS messages.</li>
<li>SMS batch mode for faster sending of multiple messages.</li>
<li>Execution of custom commands that are not directly supported.</li>
</ul>


<p>Keren bukan untuk ukuran library gratis :)</p>

<p>Pada postingan bagian pertama ini kita hanya akan membahas perintah-perintah dasar yang dibutuhkan untuk membuat aplikasi SMS Gateway, seperti <code>koneksi ke device modem atau hp</code>, <code>membaca sms masuk</code>, dan <code>mengirim sms</code>.</p>

<h3>Membuat Project</h3>

<p>Project yang kita gunakan adalah project berbasis Windows Form.</p>

<p><img class="center <a" src="href="http://coding4ever.files.wordpress.com/2014/05/1.png">http://coding4ever.files.wordpress.com/2014/05/1.png</a>&#8221;></p>

<h3>Menambahkan Library <a href="http://www.nuget.org/packages/GSMComm/">GSMComm</a> via <a href="/blog/categories/nuget/">NuGet</a></h3>

<ul>
<li><p>Klik kanan node References -> Manage NuGet Packages &hellip;</p>

<p><img class="center <a" src="href="http://coding4ever.files.wordpress.com/2014/05/21.png">http://coding4ever.files.wordpress.com/2014/05/21.png</a>&#8221;></p></li>
<li><p>Pada tab Online pilih nuget.org, pada kotak pencarian ketik <code>gsm</code>, kemudian klik tombol <code>Install</code>.</p>

<p><img class="center <a" src="href="http://coding4ever.files.wordpress.com/2014/05/3.png">http://coding4ever.files.wordpress.com/2014/05/3.png</a>&#8221;></p></li>
</ul>


<p>kemudian tunggu sampai proses instalasi selesai.</p>

<p><img class="center <a" src="href="http://coding4ever.files.wordpress.com/2014/05/4.png">http://coding4ever.files.wordpress.com/2014/05/4.png</a>&#8221;></p>

<p>Tutup dialog NuGet package, Kemudian cek node references, seharusnya ada empat library baru yang sudah ditambahkan yaitu <code>GSMCommServer</code>, <code>GSMCommShared</code>, <code>GSMCommunication</code> dan <code>PDUConverter</code>.</p>

<p><img class="center <a" src="href="http://coding4ever.files.wordpress.com/2014/05/5.png">http://coding4ever.files.wordpress.com/2014/05/5.png</a>&#8221;></p>

<p>Library <code>PDUConverter</code> bertanggung jawaban untuk melakukan proses <code>decoding</code> pesan sms, sedangkan yang bertugas untuk melakukan komunikasi ke modem atau hp adalah library <code>GSMCommunication</code>.</p>

<p>Untuk library <code>GSMCommServer</code> dan <code>GSMCommShared</code> hanya digunakan jika kita ingin mengaktifkan fitur <a href="/blog/categories/dot-net-remoting/">.NET Remoting</a> untuk mengirim sms.</p>

<p>Setelah semua persiapan selesai, kita bisa langsung mencoba perintah-perintah dasar yang diperlukan untuk pembuatan aplikasi sms gateway.</p>

<h3>1. Konek ke device modem atau hp</h3>

<p>Untuk melakukan koneksi ke modem atau hp, ada beberapa tahapan yang harus kita lakukan :</p>

<ul>
<li>Membuat objek dari class GsmCommMain</li>
<li>Mendaftarkan method ke event <code>MessageReceived</code>, yang dikenal dengan istilah <a href="http://www.codeproject.com/Articles/11657/Understanding-Delegates-in-C">delegate</a>    method.</li>
<li>Memanggil method <code>Open</code>.</li>
</ul>


<p><strong>Membuat objek dari class GsmCommMain</strong></p>

<p>Misal kita akan membuat sebuah objek dari class GsmCommMain dengan nama <code>comm</code>, maka perintahnya yang digunakan adalah :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">port</span> <span class="p">=</span> <span class="p">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">COM1</span><span class="p">&amp;</span><span class="n">rdquo</span><span class="p">;;</span> <span class="c1">// port yang digunakan menyesuaikan</span>
</span><span class='line'><span class="kt">var</span> <span class="n">baudRate</span> <span class="p">=</span> <span class="m">9600</span><span class="p">;</span>
</span><span class='line'><span class="kt">var</span> <span class="n">timeout</span> <span class="p">=</span> <span class="m">150</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">comm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GsmCommMain</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">baudRate</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><strong>Mendaftarkan method ke event <code>MessageReceived</code> yang dikenal dengan istilah <a href="http://www.codeproject.com/Articles/11657/Understanding-Delegates-in-C">delegate</a>    method</strong></p>

<p>Salah satu fitur keren yang dimiliki oleh library <a href="http://www.nuget.org/packages/GSMComm/">GSMComm</a> adalah Event <code>MessageReceived</code>. Dengan adanya event ini kita tidak perlu menggunakan objek timer untuk mengecek apakah ada sms yang masuk.</p>

<p>Event ini tidak bisa kita akses secara langsung, yang perlu kita lakukan adalah membuat sebuah method kemudian mendaftarkannya ke event ini.</p>

<p>Contoh kita membuat sebuah method dengan nama <code>comm_MessageReceived</code>, method ini hanya akan menampilkan notifikasi sms masuk. Untuk selanjutnya method ini bisa kita kembangkan lagi, misal ketika ada sms masuk datanya langsung kita simpan ke database.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">comm_MessageReceived</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageReceivedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">IndicationObject</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="n">MemoryLocation</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">loc</span> <span class="p">=</span> <span class="p">(</span><span class="n">MemoryLocation</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;New message received in storage \&quot;{0}\&quot;, index {1}.&quot;</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">loc</span><span class="p">.</span><span class="n">Storage</span><span class="p">,</span> <span class="n">loc</span><span class="p">.</span><span class="n">Index</span><span class="p">);</span>
</span><span class='line'>    <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="n">ShortMessage</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="p">(</span><span class="n">ShortMessage</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdu</span> <span class="p">=</span> <span class="n">comm</span><span class="p">.</span><span class="n">DecodeReceivedMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="s">&quot;New message received&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Kemudian kita daftarkan ke event <code>MessageReceived</code> dengan perintah :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">comm</span><span class="p">.</span><span class="n">MessageReceived</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">MessageReceivedEventHandler</span><span class="p">(</span><span class="n">comm_MessageReceived</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>sehingga ketika ada sms yang masuk method <code>comm_MessageReceived</code> akan otomatis dipanggil.</p>

<p><strong>Memanggil method <code>Open</code></strong></p>

<p>Setelah langkah pertama dan kedua selesai dikerjakan kita bisa langsung memanggil method <code>Open</code> untuk melakukan koneksi ke modem atau hp.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">comm</span><span class="p">.</span><span class="n">Open</span><span class="p">();&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">while</span> <span class="p">(!</span><span class="n">comm</span><span class="p">.</span><span class="n">IsConnected</span><span class="p">())</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msgResult</span> <span class="p">=</span> <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">No</span> <span class="n">phone</span> <span class="n">connected</span><span class="p">.&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="p">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Connection</span> <span class="n">setup</span><span class="p">&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>                                        <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">RetryCancel</span><span class="p">,</span> <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Exclamation</span><span class="p">);&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">msgResult</span> <span class="p">==</span> <span class="n">DialogResult</span><span class="p">.</span><span class="n">Cancel</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">comm</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">comm</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'>    <span class="n">comm</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>2. Membaca SMS Masuk</h3>

<p>Method yang digunakan untuk membaca sms adalah method <code>ReadMessages</code>, method ini mempunyai dua parameter yaitu <code>PhoneMessageStatus</code> dan <code>Storage</code>.</p>

<p>Untuk <code>PhoneMessageStatus</code> pilihannya adalah : <code>ReceivedUnread</code>, <code>ReceivedRead</code>, <code>StoredUnsent</code>, <code>StoredSent</code> dan <code>All</code>. Sedangkan <code>Storage</code> pilihannya hanya dua yaitu : <code>SM</code> dan <code>ME</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'>  <span class="p">&lt;</span><span class="n">br</span><span class="p">/&gt;</span>
</span><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">btnBacaSMS_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">messages</span> <span class="p">=</span> <span class="n">comm</span><span class="p">.</span><span class="n">ReadMessages</span><span class="p">(</span><span class="n">PhoneMessageStatus</span><span class="p">.</span><span class="n">All</span><span class="p">,</span> <span class="n">PhoneStorageType</span><span class="p">.</span><span class="n">Sim</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">message</span> <span class="k">in</span> <span class="n">messages</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="p">(</span><span class="n">SmsDeliverPdu</span><span class="p">)</span><span class="n">message</span><span class="p">.</span><span class="n">Data</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span>    <span class="kt">var</span> <span class="n">phoneNumber</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">OriginatingAddress</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">UserDataText</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">tanggal</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0:yyyy/MM/dd}&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">SCTimestamp</span><span class="p">.</span><span class="n">ToDateTime</span><span class="p">());</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">jam</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0:HH:mm:ss}&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">SCTimestamp</span><span class="p">.</span><span class="n">ToDateTime</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">lstDaftarSMS</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}, {1}, {2}, {3}&quot;</span><span class="p">,</span> <span class="n">tanggal</span><span class="p">,</span> <span class="n">jam</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">,</span> <span class="n">msg</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>3. Mengirim SMS</h3>

<p>Untuk mengirim sms kita menggunakan method <code>SendMessage</code> yang membutuhkan objek <a href="http://en.wikipedia.org/wiki/Protocol_data_unit">pdu</a>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">btnKirimSMS_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="n">txtPesan</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">phoneNumber</span> <span class="p">=</span> <span class="n">txtNoHp</span><span class="p">.</span><span class="n">Text</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">pdu</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SmsSubmitPdu</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span><span class='line'><span class="n">comm</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pdu</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Kode di atas hanya bisa mengirim sms dengan jumlah karakter maksimal 160 karakter, jika ingin lebih kita harus merevisi kode di atas dengan menambahkan beberapa method baru yaitu <code>CreateConcatMessage</code> dan <code>SendMultiple</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="n">OutgoingSmsPdu</span><span class="p">[]</span> <span class="nf">CreateConcatMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="kt">string</span> <span class="n">number</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">OutgoingSmsPdu</span><span class="p">[]</span> <span class="n">pdus</span> <span class="p">=</span> <span class="k">null</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">try</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">pdus</span> <span class="p">=</span> <span class="n">SmartMessageFactory</span><span class="p">.</span><span class="n">CreateConcatTextMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">number</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">catch</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="n">pdus</span><span class="p">;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">SendMultiple</span><span class="p">(</span><span class="n">OutgoingSmsPdu</span><span class="p">[]</span> <span class="n">pdus</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">pdus</span><span class="p">.</span><span class="n">Length</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">try</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Send the created messages</span>
</span><span class='line'>    <span class="n">comm</span><span class="p">.</span><span class="n">EnableTemporarySmsBatchMode</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="n">OutgoingSmsPdu</span> <span class="n">pdu</span> <span class="k">in</span> <span class="n">pdus</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">comm</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pdu</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">catch</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Terakhir kode yang ada di method <code>btnKirimSMS_Click</code> juga harus di revisi :</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">btnKirimSMS_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="n">txtPesan</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">phoneNumber</span> <span class="p">=</span> <span class="n">txtNoHp</span><span class="p">.</span><span class="n">Text</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">Length</span> <span class="p">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="m">160</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdus</span> <span class="p">=</span> <span class="n">CreateConcatMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pdus</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">SendMultiple</span><span class="p">(</span><span class="n">pdus</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">pdu</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SmsSubmitPdu</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span><span class='line'>    <span class="n">comm</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pdu</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Yuph akhirnya selesai juga.</p>

<p>Selamat <a href="https://github.com/k4m4r82/SMSGatewayNET1">MENCOBA</a> :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Update SMS Tausiyah Manager]]></title>
    <link href="http://coding4ever.net/blog/2010/08/17/update-sms-tausiyah-manager/"/>
    <updated>2010-08-17T11:00:13+07:00</updated>
    <id>http://coding4ever.net/blog/2010/08/17/update-sms-tausiyah-manager</id>
    <content type="html"><![CDATA[<p>Terima kasih saya ucapkan kepada mas <a href="/blog/2010/07/27/sms-tausiyah-manager/#comment-717">Haerul</a> atas respon penggunaan <a href="/blog/2010/07/27/sms-tausiyah-manager/">SMS Tausiyah Manager</a> dimana pada saat mencoba program ini sms yang masuk gagal dibaca oleh aplikasi service sms tausiyah.</p>

<p>Berhubung saya belum pernah mencoba menggunakan hp nokia 3110c (selama ini saya selalu menggunakan hp siemens c55), saya hanya memperkirakan hp nokia 3110c belum mendukung fitur pembacaan sms dengan mode &ldquo;Any of the storages&rdquo; atau kalo dalam istilah AT COMMANDnya disebut &ldquo;MT&rdquo;</p>

<!-- more -->


<p>Untuk mengganti secara manual lokasi pembacaan sms sudah saya tambahkan di form Setting Program</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/08/17082010-1.jpg"><img src="http://coding4ever.files.wordpress.com/2010/08/17082010-1.jpg?w=300" alt="" /></a></p>

<p>saran saya coba pilihan storage diganti menjadi <strong>DEVICE</strong></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/08/17082010-2.jpg"><img src="http://coding4ever.files.wordpress.com/2010/08/17082010-2.jpg?w=300" alt="" /></a></p>

<p>setelah perubahan berhasil disimpan, <strong>service sms tausiyah di stop dan dijalankan ulang</strong>.</p>

<p>Untuk update aplikasi SMS Tausiyah Managernya bisa didownload di<a href="http://www.4shared.com/file/lKlJN5Uu/UpdateSMSTausiyahManager.html">sini</a> (1.35 MB)</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SMS Tausiyah Manager]]></title>
    <link href="http://coding4ever.net/blog/2010/07/27/sms-tausiyah-manager/"/>
    <updated>2010-07-27T13:50:53+07:00</updated>
    <id>http://coding4ever.net/blog/2010/07/27/sms-tausiyah-manager</id>
    <content type="html"><![CDATA[<p><strong>Intro</strong></p>

<p>Dalam rangka menyambut bulan suci Ramadhan 1431 H saya merilis aplikasi sms gateway gratis dengan nama &ldquo;<strong>SMS Tausiyah Manager</strong>&rdquo;, aplikasi ini saya buat menggunakan Visual Basic 6 dan untuk databasenya menggunakan<a href="/blog/2010/06/14/mengenal-lebih-dekat-database-sqlite/"> SQLite</a> plus proses <a href="/blog/2009/12/31/membuat-paket-instalasi-vb-mysql-dengan-inno-setup/">instalasi</a> yang sangat mudah sehingga siapa pun bisa dengan gampang mendistribusikan dan menggunakan aplikasi ini :D</p>

<p>Jadi jika Anda mempunyai kenalan/relasi yang mempunyai agenda/kegiatan Islami selama bulan suci Ramadhan, mungkin agenda tambahan berupa layanan SMS Tausiyah gratis ini bisa dijadikan sebagai bahan pertimbangan.</p>

<p>Aplikasi ini saya bagi menjadi dua :</p>

<ol>
<li><p>SMS Service, bagian yang bertugas untuk menangani sms masuk dan keluar</p></li>
<li><p>SMS Manager bagian pengolahan data (member, kontak, inbox, outbox dan lain-lain)</p></li>
</ol>


<p><strong>Keyword</strong></p>

<ol>
<li><p><strong>reg#nama</strong>, sesuai namanya keyword ini untuk berlangganan layanan sms tausiyah</p></li>
<li><p><strong>unreg</strong>, untuk berhenti berlangganan layanan sms tausiyah</p></li>
<li><p><strong>saran#isi saran</strong></p></li>
</ol>


<!-- more -->


<p><strong>Kebutuhan Sistem</strong></p>

<ol>
<li><p>PC/Laptop, berhubung saya developnya di Win XP sebaiknya Anda juga menggunakan OS yang sama :D</p></li>
<li><p>Untuk modem cukup menggunakan hp + kabel data, untuk mengetes program ini saya menggunakan hp Siemens C55 dengan kabel data Cellular One (port USB)</p></li>
<li><p>Dan tentunya Software SMS Tausiyah Manager :D</p></li>
</ol>


<p>Berikut adalah daftar modem/hp yang didukung oleh aplikasi ini :</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/modem.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/modem.jpg?w=300" alt="" /></a></p>

<p><strong>Petunjuk Instalasi dan Penggunaan</strong></p>

<ol>
<li><p><a href="http://www.4shared.com/file/mc5Gpa8-/Petunjuk_Instalasi_Kabel_Data.html">Instalasi perangkat kabel data hp yang akan digunakan</a> (342 kb)</p></li>
<li><p><a href="http://www.4shared.com/file/wIrFxQ7G/Petunjuk_Instalasi_SMS_Tausiya.html">Instalasi SMS Tausiyah Manager</a> (205 kb)</p></li>
<li><p><a href="http://www.4shared.com/file/joSYMAGK/Petunjuk_Penggunaan_SMS_Tausiy.html">Petunjuk penggunaan SMS Tausiyah Manager</a> (548 kb)</p></li>
<li><p><a href="http://www.4shared.com/file/wR4saFiR/Petunjuk_Penggunaan_SMS_Tausiy.html">Petunjuk penggunaan SMS Tausiyah Service</a> (48 kb)</p></li>
</ol>


<p><strong>Screenshot</strong></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/27072010-1.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/27072010-1.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/27072010-2.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/27072010-2.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/27072010-3.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/27072010-3.jpg?w=300" alt="" /></a></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/27072010-41.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/27072010-41.jpg" alt="" /></a></p>

<p><strong>Link Download</strong></p>

<p>File instalasi SMS Tausiyah Manager bisa Anda download di<a href="http://www.4shared.com/file/RwGUUwVM/SetupSMSTausiyah.html">SINI</a> (5.43 mb), aplikasi ini baru saya tes di Windows XP, dan untuk Windows 7 mudah-mudahan tidak ada masalah kompabilitas :D</p>

<p><strong>Laporan bug/error</strong></p>

<p>Berhubung terbatasnya resource yang saya gunakan untuk mengetes aplikasi ini, jika ada bug/error yang Anda temukan selama mencoba aplikasi ini mohon konfirmasinya ke <a href="k4m4r82@yahoo.com">k4m4r82@yahoo.com</a>.</p>

<p>Selamat mencoba :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Membuat Sms Gateway Itu Gampang, Jangan Dipersulit !!!]]></title>
    <link href="http://coding4ever.net/blog/2010/07/12/membuat-sms-gateway-itu-gampang-jangan-dipersulit/"/>
    <updated>2010-07-12T07:01:35+07:00</updated>
    <id>http://coding4ever.net/blog/2010/07/12/membuat-sms-gateway-itu-gampang-jangan-dipersulit</id>
    <content type="html"><![CDATA[<p>Berhubung banyaknya pengunjung yang nyasar ke blog ini, gara-gara keyword &ldquo;<strong>sms gateway</strong>&rdquo; saya jadi merasa bersalah klo enggax ikut-ikutan membahas artikel yang satu ini he he he :D.</p>

<p>Walaupun sudah banyak blog yang membahas tentang masalah ini, tapi kayaxnya tema &ldquo;<strong>sms gateway</strong>&rdquo; masih hangat dan <strong>saru</strong> eh&hellip; seru untuk dibahas :D, dan tentunya dengan adanya artikel ini saya berharap lebih banyak lagi yang tersesat ke blog ini :D.</p>

<p>Oke jadi kasusnya apa nih, kita ambil aja sample sederhana yaitu &ldquo;<strong>pembuatan sms gateway untuk request nilai siswa</strong>&rdquo; dan untuk menyederhanakan pembahasan keywordnya kita batasi saja yaitu <strong>request</strong> <strong>nilai tugas</strong> dan <strong>ulangan</strong>.</p>

<p>Apa yang harus di persiapkan, pertama kita rancang dulu databasenya dan berhubung <a href="/blog/2010/06/14/mengenal-lebih-dekat-database-sqlite/">artikel</a> saya yang membahas tentang database SQLite masih hangat jadi untuk databasenya kita menggunakan SQLite saja.</p>

<!-- more -->


<p>SQLite adalah database standalone yang kecil, mungil dan gratis. Bagaimana cara membuat database di SQLite sudah saya bahas di<a href="/blog/2010/06/14/mengenal-lebih-dekat-database-sqlite/">sini</a> kemudian bagaimana mengaksesnya dari aplikasi juga sudah saya bahasa di<a href="/blog/2010/07/05/mengakses-database-sqlite-menggunakan-library-dhsqlite/">sini</a>.</p>

<p>Berikut adalah rancangan sederhana database sms yang akan kita buat :</p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/12072010-1.png"><img src="http://coding4ever.files.wordpress.com/2010/07/12072010-1.png?w=300" alt="" /></a></p>

<p>Ada banyak cara untuk membaca sms masuk dan membalasanya, salah satunya adalah menggunakan perintah <a href="http://www.developershome.com/sms/atCommandsIntro.asp">AT COMMAND</a> dan Microsoft sendiri sudah menyediakan <a href="http://support.microsoft.com/kb/194922">komponen</a> yang bisa mengeksekusi perintah-perintah tersebut.</p>

<p>Tentunya cara ini (menggunakan <a href="http://www.developershome.com/sms/atCommandsIntro.asp">AT COMMAND</a>) bukan cara yang favorit dikalangan programmer instan seperti Anda dan Saya :D, jadi diartikel ini saya menggunakan <a href="http://www.activexperts.com/xmstoolkit/">komponen</a> pihak ketiga.</p>

<blockquote><p>Ingat komponen ini adalah shareware, segala resiko (kemudahan dalam membuat aplikasi sms gateway) ditanggung sendiri :D, saya disini hanya share dan tidak terikat kerja sama dengan pihak ketiga tersebut.</p></blockquote>

<p>Halah pernyataan ngawur :D</p>

<p>Berikut adalah cuplikan source code untuk membaca dan mengirim sms menggunakan komponen <a href="http://www.activexperts.com/xmstoolkit/">ActiveXpert SMS</a></p>

<p><strong>1. Membaca SMS Masuk</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">cmdBacaSMS_Click</span><span class="p">()</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objGsmIn</span>        <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmIn</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">Set</span> <span class="n">objGsmIn</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmIn</span>
</span><span class='line'><span class="k">With</span> <span class="n">objGsmIn</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Activate</span> <span class="s">&quot;XXX-XXXX-XXXX-XXXXX&quot;</span>  <span class="c">&#39;diisi serial number yg Anda dapatkan secara ilegal</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Device</span> <span class="o">=</span> <span class="s">&quot;COM1&quot;</span> <span class="c">&#39;disesuaikan dengan port COM yang digunakan</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DeviceSpeed</span> <span class="o">=</span> <span class="mi">19200</span> <span class="c">&#39;default = 0</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">.</span><span class="n">Storage</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">&#39;0=sim 1=device 2=any</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DeleteAfterReceive</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Receive</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">If</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">Or</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">23140</span> <span class="k">Then</span> <span class="c">&#39; Success</span>
</span><span class='line'>        <span class="p">.</span><span class="n">GetFirstMessage</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">While</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="n">Debug</span><span class="p">.</span><span class="n">Print</span> <span class="s">&quot;Pengirim : &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="p">.</span><span class="n">MessageSender</span>
</span><span class='line'>            <span class="n">Debug</span><span class="p">.</span><span class="n">Print</span> <span class="s">&quot;Isi SMS : &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="p">.</span><span class="n">MessageData</span>
</span><span class='line'>
</span><span class='line'>            <span class="c">&#39;TODO : INSERT KE TABEL SMS_IN</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">.</span><span class="n">GetNextMessage</span>
</span><span class='line'>        <span class="k">Wend</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'><span class="k">End</span> <span class="k">With</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsmIn</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><strong>2. Mengirim sms</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">cmdKirimSMS_Click</span><span class="p">()</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objGsmOut</span>       <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objConstants</span>    <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">Set</span> <span class="n">objGsmOut</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objConstants</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span>
</span><span class='line'>
</span><span class='line'><span class="k">With</span> <span class="n">objGsmOut</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Activate</span> <span class="s">&quot;XXX-XXXX-XXXX-XXXXX&quot;</span>  <span class="c">&#39;diisi serial number yg Anda dapatkan secara ilegal</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Device</span> <span class="o">=</span> <span class="s">&quot;COM1&quot;</span> <span class="c">&#39;disesuaikan dengan port COM yang digunakan</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DeviceSpeed</span> <span class="o">=</span> <span class="mi">19200</span> <span class="c">&#39;default = 0</span>
</span><span class='line'>    <span class="p">.</span><span class="n">RequestStatusReport</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">.</span><span class="n">MessageType</span> <span class="o">=</span> <span class="n">objConstants</span><span class="p">.</span><span class="n">asMESSAGETYPE_TEXT</span> <span class="c">&#39;mengirim pesan maksimal 160 karakter</span>
</span><span class='line'>    <span class="c">&#39;.MessageType = objConstants.asMESSAGETYPE_TEXT_MULTIPART &#39;jika lebih dari 160 karakter gunakan opsi ini</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">.</span><span class="n">MessageRecipient</span> <span class="o">=</span> <span class="s">&quot;nomor tujuan&quot;</span> <span class="c">&#39;biasanya menggunakan prefix +62</span>
</span><span class='line'>    <span class="p">.</span><span class="n">MessageData</span> <span class="o">=</span> <span class="s">&quot;isi pesan&quot;</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Send</span> <span class="c">&#39;kirim</span>
</span><span class='line'><span class="k">End</span> <span class="k">With</span>
</span><span class='line'>
</span><span class='line'><span class="k">Set</span> <span class="n">objConstants</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsmOut</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Jadi cukup dengan bermodalkan 2 cuplikan kode diatas kita akan menyelesaikan aplikasi yg dibahas pada artikel kali ini.</p>

<p>Adapun untuk keyword yang akan digunakan sebagai berikut :</p>

<p><strong>1. Request nilai tugas</strong></p>

<p>keyword : tgs#nis</p>

<p>contoh :
tgs#9941224165</p>

<p>balasan :
Nilai tugas (NAMA SISWA) : BI=95, IPA=75, IPS=80, MTK=85</p>

<p><strong>2. Request nilai ulangan harian</strong></p>

<p>keyword : uh#nis</p>

<p>contoh :
uh#9941224165</p>

<p>balasan :
Nilai ulangan (NAMA SISWA) : BI=95, IPA=75, IPS=80, MTK=85</p>

<p>Berikut penjelasan ringkas beberapa cuplikan source code yang digunakan dalam pembuatan aplikasi sms gateway ini.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Function</span> <span class="nf">connectToDevice</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">device</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">Boolean</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objGsm</span>      <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">manufaktur</span>  <span class="ow">As</span> <span class="kt">String</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span>
</span><span class='line'>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsm</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'><span class="k">With</span> <span class="n">objGsm</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Activate</span> <span class="n">SERIAL_NUMBER</span>
</span><span class='line'>    <span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">manufaktur</span> <span class="o">=</span> <span class="p">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="s">&quot;AT+CGMI&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>  <span class="c">&#39;menampilkan informasi manufactur</span>
</span><span class='line'>    <span class="n">manufaktur</span> <span class="o">=</span> <span class="n">Replace$</span><span class="p">(</span><span class="n">manufaktur</span><span class="p">,</span> <span class="n">vbCrLf</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">manufaktur</span> <span class="o">=</span> <span class="n">Replace$</span><span class="p">(</span><span class="n">manufaktur</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">manufaktur</span> <span class="o">=</span> <span class="n">Replace$</span><span class="p">(</span><span class="n">manufaktur</span><span class="p">,</span> <span class="s">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">manufaktur</span> <span class="o">=</span> <span class="n">Replace$</span><span class="p">(</span><span class="n">manufaktur</span><span class="p">,</span> <span class="s">&quot;AT+CGMI&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">End</span> <span class="k">With</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsm</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>
</span><span class='line'><span class="k">If</span> <span class="n">Len</span><span class="p">(</span><span class="n">manufaktur</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>    <span class="n">txtModem</span><span class="p">.</span><span class="n">Text</span> <span class="o">=</span> <span class="n">manufaktur</span>
</span><span class='line'>    <span class="n">connectToDevice</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'><span class="err">&lt;/</span><span class="nf">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="n">errHandle</span><span class="p">:</span>
</span><span class='line'>    <span class="n">connectToDevice</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Sesuai namanya fungsi connectToDevice digunakan untuk mengecek status modem sms yang terpasang, salah satu caranya adalah dengan mengirimkan <a href="http://www.developershome.com/sms/atCommandsIntro.asp">AT COMMAND</a> &ldquo;AT+CGM&rdquo;, <a href="http://www.developershome.com/sms/atCommandsIntro.asp">AT COMMAND</a> ini berfungsi untuk mendapatkan informasi manufaktur.</p>

<p>Sebagai contoh jika modem sms yg digunakan adalah hp siemens maka nilai yg dihasilkan dari perintah ini adalah &ldquo;SIEMENS&rdquo; dan tentunya hp yg bersangkutan juga harus mendukung AT COMMAND.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">readSMS</span><span class="p">()</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objGsmIn</span>        <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmIn</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">objConstants</span>    <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">cmd</span>             <span class="ow">As</span> <span class="n">cCommand</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">Dim</span> <span class="n">keyword</span>         <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">phoneNumber</span>     <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">i</span>               <span class="ow">As</span> <span class="kt">Integer</span>
</span><span class='line'>
</span><span class='line'><span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span>
</span><span class='line'>
</span><span class='line'><span class="n">Screen</span><span class="p">.</span><span class="n">MousePointer</span> <span class="o">=</span> <span class="n">vbHourglass</span>
</span><span class='line'><span class="n">cmdStop</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'><span class="n">tmrReceiveSms</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'>
</span><span class='line'><span class="n">DoEvents</span>
</span><span class='line'>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsmIn</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmIn</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objConstants</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span>
</span><span class='line'>
</span><span class='line'><span class="k">With</span> <span class="n">objGsmIn</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Activate</span> <span class="n">SERIAL_NUMBER</span>
</span><span class='line'>    <span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">cmbPORT</span><span class="p">.</span><span class="n">Text</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DeviceSpeed</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">.</span><span class="n">Storage</span> <span class="o">=</span> <span class="n">cmbStorage</span><span class="p">.</span><span class="n">ItemData</span><span class="p">(</span><span class="n">cmbStorage</span><span class="p">.</span><span class="n">ListIndex</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DeleteAfterReceive</span> <span class="o">=</span> <span class="k">True</span> <span class="c">&#39;hapus sms jika sudah dibaca</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Receive</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">If</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">Or</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">23140</span> <span class="k">Then</span> <span class="c">&#39;baca sms sukses</span>
</span><span class='line'>        <span class="p">.</span><span class="n">GetFirstMessage</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO sms_in (phone_number, sms_keyword, date_in, time_in) VALUES (?, ?, ?, ?)&quot;</span>
</span><span class='line'>        <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">CreateCommand</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>        <span class="n">conn</span><span class="p">.</span><span class="n">BeginTrans</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">While</span> <span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="n">phoneNumber</span> <span class="o">=</span> <span class="n">rep0to62</span><span class="p">(.</span><span class="n">MessageSender</span><span class="p">)</span>
</span><span class='line'>            <span class="n">keyword</span> <span class="o">=</span> <span class="p">.</span><span class="n">MessageData</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">cmd</span><span class="p">.</span><span class="n">SetText</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phoneNumber</span>
</span><span class='line'>            <span class="n">cmd</span><span class="p">.</span><span class="n">SetText</span> <span class="mi">2</span><span class="p">,</span> <span class="n">keyword</span>
</span><span class='line'>            <span class="n">cmd</span><span class="p">.</span><span class="n">SetDate</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Format</span><span class="p">(</span><span class="n">Now</span><span class="p">,</span> <span class="s">&quot;yyyy/MM/dd&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">cmd</span><span class="p">.</span><span class="n">SetTime</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Format</span><span class="p">(</span><span class="n">Now</span><span class="p">,</span> <span class="s">&quot;hh:mm:ss&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">cmd</span><span class="p">.</span><span class="n">Execute</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">If</span> <span class="n">i</span> <span class="ow">Mod</span> <span class="mi">10</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>                <span class="n">conn</span><span class="p">.</span><span class="n">CommitTrans</span>
</span><span class='line'>                <span class="n">DoEvents</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">conn</span><span class="p">.</span><span class="n">BeginTrans</span>
</span><span class='line'>            <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">.</span><span class="n">GetNextMessage</span>
</span><span class='line'>        <span class="k">Wend</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">conn</span><span class="p">.</span><span class="n">CommitTrans</span>
</span><span class='line'>        <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'><span class="k">End</span> <span class="k">With</span>
</span><span class='line'><span class="k">Set</span> <span class="n">objGsmIn</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>
</span><span class='line'><span class="k">If</span> <span class="n">cekSMSIn</span> <span class="k">Then</span>
</span><span class='line'>    <span class="k">Call</span> <span class="n">sendSMS</span>
</span><span class='line'><span class="k">Else</span>
</span><span class='line'>    <span class="k">Call</span> <span class="n">Wait</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="n">cmdStop</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'><span class="n">Screen</span><span class="p">.</span><span class="n">MousePointer</span> <span class="o">=</span> <span class="n">vbDefault</span>
</span><span class='line'>
</span><span class='line'><span class="n">tmrReceiveSms</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">Exit</span> <span class="k">Sub</span>
</span><span class='line'><span class="err">&lt;/</span><span class="nf">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="n">errHandle</span><span class="p">:</span>
</span><span class='line'>    <span class="n">tmrReceiveSms</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Prosedur readSMS digunakan untuk membaca sms masuk dan menyimpannya ke tabel sms_in, berhubung komponen ActiveXpert SMS tidak mempunyai event yg menandai adanya sms masuk maka sebagai gantinya kita menggunakan timer untuk memanggil prosedur readSMS.</p>

<p>Salah satu properties penting yang dimiliki oleh ActiveXpert SMS adalah DeleteAfterReceive, jika nilainya diset true maka sms yg masuk akan otomatis dihapus dan tentunya setelah smsnya dibaca.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Function</span> <span class="nf">cekSMSIn</span><span class="p">()</span> <span class="ow">As</span> <span class="kt">Boolean</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">ret</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT COUNT(*) FROM sms_in WHERE status = 0&quot;</span> <span class="c">&#39;jika status = 0 berarti sms masuk belum di proses</span>
</span><span class='line'><span class="n">ret</span> <span class="o">=</span> <span class="k">CInt</span><span class="p">(</span><span class="n">dbGetValue</span><span class="p">(</span><span class="n">strSql</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'><span class="k">If</span> <span class="n">ret</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="c">&#39;ada sms yg belum diproses</span>
</span><span class='line'>    <span class="n">cekSMSIn</span> <span class="o">=</span> <span class="k">True</span>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Prosedur cekSMSIn dibutuhkan oleh prosedur readSMS, jadi dengan adanya prosedur cekSMSIn ini program akan mengetahui kapan waktu yg tepat untuk memanggil prosedur sendSMS.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">sendSMS</span><span class="p">()</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">rsSend</span>          <span class="ow">As</span> <span class="n">cRecordset</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">cmd</span>             <span class="ow">As</span> <span class="n">cCommand</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">Dim</span> <span class="n">objGsmOut</span>       <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">objConstants</span>    <span class="ow">As</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span>
</span><span class='line'>
</span><span class='line'><span class="k">Dim</span> <span class="n">phoneNumber</span>     <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">keyword</span>         <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">smsBalasan</span>      <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>
</span><span class='line'><span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">errHandle</span>
</span><span class='line'>
</span><span class='line'><span class="c">&#39;cek sms yang belum di proses, ditandai dg status = 0</span>
</span><span class='line'><span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT id, phone_number, sms_keyword &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>         <span class="s">&quot;FROM sms_in &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>         <span class="s">&quot;WHERE status = 0 &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>         <span class="s">&quot;ORDER BY id&quot;</span>
</span><span class='line'><span class="k">Set</span> <span class="n">rsSend</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">OpenRecordset</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'><span class="k">If</span> <span class="k">Not</span> <span class="n">rsSend</span><span class="p">.</span><span class="n">EOF</span> <span class="k">Then</span>
</span><span class='line'>    <span class="k">Set</span> <span class="n">objGsmOut</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">GsmOut</span>
</span><span class='line'>    <span class="k">Set</span> <span class="n">objConstants</span> <span class="o">=</span> <span class="k">New</span> <span class="n">ASmsCtrl</span><span class="p">.</span><span class="n">Constants</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">objGsmOut</span><span class="p">.</span><span class="n">Activate</span> <span class="n">SERIAL_NUMBER</span>
</span><span class='line'>    <span class="n">objGsmOut</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">cmbPORT</span><span class="p">.</span><span class="n">Text</span>
</span><span class='line'>    <span class="n">objGsmOut</span><span class="p">.</span><span class="n">DeviceSpeed</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">objGsmOut</span><span class="p">.</span><span class="n">RequestStatusReport</span> <span class="o">=</span> <span class="k">False</span>
</span><span class='line'>    <span class="n">objGsmOut</span><span class="p">.</span><span class="n">MessageType</span> <span class="o">=</span> <span class="n">objConstants</span><span class="p">.</span><span class="n">asMESSAGETYPE_TEXT_MULTIPART</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Do</span> <span class="k">While</span> <span class="k">Not</span> <span class="n">rsSend</span><span class="p">.</span><span class="n">EOF</span>
</span><span class='line'>        <span class="c">&#39;ganti prefix nomor hp 0 -&amp;gt; +62</span>
</span><span class='line'>        <span class="n">phoneNumber</span> <span class="o">=</span> <span class="n">rep0to62</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">rsSend</span><span class="p">(</span><span class="s">&quot;phone_number&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">)</span>
</span><span class='line'>        <span class="n">keyword</span> <span class="o">=</span> <span class="n">rsSend</span><span class="p">(</span><span class="s">&quot;sms_keyword&quot;</span><span class="p">).</span><span class="n">Value</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">smsBalasan</span> <span class="o">=</span> <span class="n">getBalasanSms</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">objGsmOut</span><span class="p">.</span><span class="n">MessageRecipient</span> <span class="o">=</span> <span class="n">phoneNumber</span>
</span><span class='line'>        <span class="n">objGsmOut</span><span class="p">.</span><span class="n">MessageData</span> <span class="o">=</span> <span class="n">smsBalasan</span>
</span><span class='line'>        <span class="n">objGsmOut</span><span class="p">.</span><span class="n">Send</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">If</span> <span class="n">objGsmOut</span><span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">Or</span> <span class="n">objGsmOut</span><span class="p">.</span><span class="n">LastError</span> <span class="o">=</span> <span class="mi">23140</span> <span class="k">Then</span> <span class="c">&#39;sms sukses dikirim</span>
</span><span class='line'>            <span class="c">&#39;update status sms -&amp;gt; 1</span>
</span><span class='line'>            <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;UPDATE sms_in SET status = ?, no_ref = ? &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                     <span class="s">&quot;WHERE id = ?&quot;</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">CreateCommand</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>            <span class="k">With</span> <span class="n">cmd</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">2</span><span class="p">,</span> <span class="n">objGsmOut</span><span class="p">.</span><span class="n">MessageReference</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">3</span><span class="p">,</span> <span class="n">rsSend</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">).</span><span class="n">Value</span>
</span><span class='line'>
</span><span class='line'>                <span class="p">.</span><span class="n">Execute</span>
</span><span class='line'>            <span class="k">End</span> <span class="k">With</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>
</span><span class='line'>            <span class="c">&#39;insert ke tabel sms_out, untuk histori sms keluar</span>
</span><span class='line'>            <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO sms_out (phone_number, replay_msg, date_out, time_out) VALUES (?, ?, ?, ?)&quot;</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">CreateCommand</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>            <span class="k">With</span> <span class="n">cmd</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetText</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phoneNumber</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetText</span> <span class="mi">2</span><span class="p">,</span> <span class="n">smsBalasan</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetDate</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Format</span><span class="p">(</span><span class="n">Now</span><span class="p">,</span> <span class="s">&quot;yyyy/MM/dd&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetTime</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Format</span><span class="p">(</span><span class="n">Now</span><span class="p">,</span> <span class="s">&quot;hh:mm:ss&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>                <span class="p">.</span><span class="n">Execute</span>
</span><span class='line'>            <span class="k">End</span> <span class="k">With</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">Else</span> <span class="c">&#39;sms gagal dikirim</span>
</span><span class='line'>            <span class="c">&#39;update status sms -&amp;gt; 1</span>
</span><span class='line'>
</span><span class='line'>            <span class="c">&#39;ini masih bisa dikembangkan lagi dengan menambah kolom max_jumlah_kirim di tabel sms_in</span>
</span><span class='line'>            <span class="c">&#39;jadi bisa diberi aturan sms yg gagal dikirim &amp;gt; 3x baru status smsnya diupdate menjadi 1</span>
</span><span class='line'>            <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;UPDATE sms_in SET status = ?, no_ref = ? &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                     <span class="s">&quot;WHERE id = ?&quot;</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">CreateCommand</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>            <span class="k">With</span> <span class="n">cmd</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">2</span><span class="p">,</span> <span class="n">objGsmOut</span><span class="p">.</span><span class="n">MessageReference</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SetInt32</span> <span class="mi">3</span><span class="p">,</span> <span class="n">rsSend</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">).</span><span class="n">Value</span>
</span><span class='line'>
</span><span class='line'>                <span class="p">.</span><span class="n">Execute</span>
</span><span class='line'>            <span class="k">End</span> <span class="k">With</span>
</span><span class='line'>            <span class="k">Set</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">Call</span> <span class="n">Wait</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">rsSend</span><span class="p">.</span><span class="n">MoveNext</span>
</span><span class='line'>    <span class="k">Loop</span>
</span><span class='line'>    <span class="k">Set</span> <span class="n">objConstants</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'>    <span class="k">Set</span> <span class="n">objGsmOut</span> <span class="o">=</span> <span class="k">Nothing</span>
</span><span class='line'><span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="k">Exit</span> <span class="k">Sub</span>
</span><span class='line'><span class="err">&lt;/</span><span class="nf">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="n">errHandle</span><span class="p">:</span>
</span><span class='line'>    <span class="k">Resume</span> <span class="k">Next</span>
</span><span class='line'><span class="k">End</span> <span class="k">Sub</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Prosedur sendSMS akan mengolah sms masuk yg belum di proses (ditandai dengan status = 0), mengupdate statusnya menjadi 1 jika berhasil mengirimkan sms, kemudian menyimpannya ke tabel sms_out sebagai histori pengiriman sms.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Public</span> <span class="k">Function</span> <span class="nf">rep0to62</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">phoneNumber</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lsquo</span><span class="err">;</span><span class="n">fungsi</span> <span class="n">untuk</span> <span class="n">mengganti</span> <span class="n">prefix</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">62</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">rep0to62</span> <span class="o">=</span> <span class="n">phoneNumber</span>
</span><span class='line'><span class="k">If</span> <span class="n">Left</span><span class="p">(</span><span class="n">phoneNumber</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span> <span class="k">Then</span> <span class="n">rep0to62</span> <span class="o">=</span> <span class="s">&quot;+62&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">Right</span><span class="p">(</span><span class="n">phoneNumber</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">phoneNumber</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Sesuai namanya fungsi ini berguna untuk mengganti prefix nomor hp 0 menjadi +62 (kode indonesia).</p>

<p>Terakhir fungsi untuk memproses keyword sms yang masuk dan sekaligus sebagai balasan untuk sms keluar.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="k">Public</span> <span class="k">Function</span> <span class="nf">getBalasanSms</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">keywordSms</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">phoneNumber</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">rs</span>              <span class="ow">As</span> <span class="n">cRecordset</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">param1</span>          <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>    <span class="k">Dim</span> <span class="n">arrKeyword</span><span class="p">()</span>    <span class="ow">As</span> <span class="kt">String</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;pre&gt;</span><span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">Dim</span> <span class="n">prefix</span>          <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">nilai</span>           <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">nama</span>            <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>
</span><span class='line'><span class="k">Dim</span> <span class="n">tha</span>             <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'><span class="k">Dim</span> <span class="n">semester</span>        <span class="ow">As</span> <span class="kt">String</span>
</span><span class='line'>
</span><span class='line'><span class="k">If</span> <span class="n">Len</span><span class="p">(</span><span class="n">keywordSms</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>    <span class="k">If</span> <span class="n">InStr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keywordSms</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="c">&#39;karakter # -&amp;gt; separator keyword</span>
</span><span class='line'>        <span class="n">arrKeyword</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">keywordSms</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="p">(</span><span class="n">Len</span><span class="p">(</span><span class="n">arrKeyword</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Keyword sms salah&quot;</span>
</span><span class='line'>            <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>
</span><span class='line'>        <span class="nf">Else</span>
</span><span class='line'>            <span class="c">&#39;do nothing</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Else</span>
</span><span class='line'>        <span class="k">ReDim</span> <span class="n">arrKeyword</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="n">arrKeyword</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">keywordSms</span>
</span><span class='line'>    <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="k">Else</span>
</span><span class='line'>    <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Keyword sms salah&quot;</span>
</span><span class='line'>    <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'><span class="nf">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'><span class="n">prefix</span> <span class="o">=</span> <span class="n">arrKeyword</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="n">prefix</span> <span class="o">=</span> <span class="n">UCase$</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">If</span> <span class="n">UBound</span><span class="p">(</span><span class="n">arrKeyword</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span> <span class="n">param1</span> <span class="o">=</span> <span class="n">arrKeyword</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">&#39;untuk contoh disini param1 bernilai nomor induk siswa</span>
</span><span class='line'>
</span><span class='line'><span class="c">&#39;untuk pengembangan lebih lanjut tahun ajaran dan semester dibuat settingan tersendiri</span>
</span><span class='line'><span class="n">tha</span> <span class="o">=</span> <span class="s">&quot;2009/2010&quot;</span>
</span><span class='line'><span class="n">semester</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="k">Select</span> <span class="k">Case</span> <span class="n">prefix</span>
</span><span class='line'>    <span class="k">Case</span> <span class="s">&quot;TGS&quot;</span>
</span><span class='line'>        <span class="c">&#39;validasi nis siswa</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">isValidNIS</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span> <span class="k">Then</span> <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">NIS_SALAH</span><span class="p">,</span> <span class="s">&quot;&amp;lt;nis&amp;gt;&quot;</span><span class="p">,</span> <span class="n">param1</span><span class="p">):</span> <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>
</span><span class='line'>        <span class="err">&#39;</span><span class="nf">validasi</span> <span class="n">no</span> <span class="n">hp</span> <span class="n">siswa</span>
</span><span class='line'>        <span class="c">&#39;nama sekolah sebaiknya disimpan didalam variabel</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">isValidHPSiswa</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">HP_UNREG</span><span class="p">,</span> <span class="s">&quot;&amp;lt;nama_sekolah&amp;gt;&quot;</span><span class="p">,</span> <span class="s">&quot;SMA Negeri Yogyakarta&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">getBalasanSms</span><span class="p">,</span> <span class="s">&quot;&amp;lt;no_hp&amp;gt;&quot;</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">):</span> <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>        <span class="nf">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT UPPER(nama) FROM siswa WHERE nis = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">param1</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39;&quot;</span>
</span><span class='line'>        <span class="n">nama</span> <span class="o">=</span> <span class="k">CStr</span><span class="p">(</span><span class="n">dbGetValue</span><span class="p">(</span><span class="n">strSql</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&#39;mulai proses pencarian nilai</span>
</span><span class='line'>        <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT matapelajaran_kode, nilai &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;FROM nilai_tugas &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;WHERE siswa_nis = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">param1</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39; AND tahun_ajaran = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">tha</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39; AND semester = &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">semester</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot; &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;ORDER BY matapelajaran_kode&quot;</span>
</span><span class='line'>        <span class="k">Set</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">OpenRecordset</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">rs</span><span class="p">.</span><span class="n">EOF</span> <span class="k">Then</span>
</span><span class='line'>            <span class="k">Do</span> <span class="k">While</span> <span class="k">Not</span> <span class="n">rs</span><span class="p">.</span><span class="n">EOF</span>
</span><span class='line'>                <span class="n">nilai</span> <span class="o">=</span> <span class="n">nilai</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">rs</span><span class="p">(</span><span class="s">&quot;matapelajaran_kode&quot;</span><span class="p">).</span><span class="n">Value</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;=&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">rs</span><span class="p">(</span><span class="s">&quot;nilai&quot;</span><span class="p">).</span><span class="n">Value</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;, &quot;</span>
</span><span class='line'>                <span class="n">rs</span><span class="p">.</span><span class="n">MoveNext</span>
</span><span class='line'>            <span class="k">Loop</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">If</span> <span class="n">Len</span><span class="p">(</span><span class="n">nilai</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">nilai</span> <span class="o">=</span> <span class="n">Left</span><span class="p">(</span><span class="n">nilai</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">nilai</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Nilai tugas (&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nama</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;) : &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nilai</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">Else</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Nilai tugas (&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nama</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;) sedang dalam proses pendataan&quot;</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Case</span> <span class="s">&quot;UH&quot;</span>
</span><span class='line'>        <span class="c">&#39;validasi nis siswa</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">isValidNIS</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span> <span class="k">Then</span> <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">NIS_SALAH</span><span class="p">,</span> <span class="s">&quot;&amp;lt;nis&amp;gt;&quot;</span><span class="p">,</span> <span class="n">param1</span><span class="p">):</span> <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>
</span><span class='line'>        <span class="err">&#39;</span><span class="nf">validasi</span> <span class="n">no</span> <span class="n">hp</span> <span class="n">siswa</span>
</span><span class='line'>        <span class="c">&#39;nama sekolah sebaiknya disimpan didalam variabel</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">isValidHPSiswa</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">)</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">HP_UNREG</span><span class="p">,</span> <span class="s">&quot;&amp;lt;nama_sekolah&amp;gt;&quot;</span><span class="p">,</span> <span class="s">&quot;SMA Negeri Yogyakarta&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="n">Replace</span><span class="p">(</span><span class="n">getBalasanSms</span><span class="p">,</span> <span class="s">&quot;&amp;lt;no_hp&amp;gt;&quot;</span><span class="p">,</span> <span class="n">phoneNumber</span><span class="p">):</span> <span class="k">Exit</span> <span class="k">Function</span>
</span><span class='line'>        <span class="nf">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT UPPER(nama) FROM siswa WHERE nis = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">param1</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39;&quot;</span>
</span><span class='line'>        <span class="n">nama</span> <span class="o">=</span> <span class="k">CStr</span><span class="p">(</span><span class="n">dbGetValue</span><span class="p">(</span><span class="n">strSql</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&#39;mulai proses pencarian nilai</span>
</span><span class='line'>        <span class="n">strSql</span> <span class="o">=</span> <span class="s">&quot;SELECT matapelajaran_kode, nilai &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;FROM nilai_ulangan &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;WHERE siswa_nis = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">param1</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39; AND tahun_ajaran = &#39;&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">tha</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;&#39; AND semester = &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">semester</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot; &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">_</span>
</span><span class='line'>                 <span class="s">&quot;ORDER BY matapelajaran_kode&quot;</span>
</span><span class='line'>        <span class="k">Set</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">OpenRecordset</span><span class="p">(</span><span class="n">strSql</span><span class="p">)</span>
</span><span class='line'>        <span class="k">If</span> <span class="k">Not</span> <span class="n">rs</span><span class="p">.</span><span class="n">EOF</span> <span class="k">Then</span>
</span><span class='line'>            <span class="k">Do</span> <span class="k">While</span> <span class="k">Not</span> <span class="n">rs</span><span class="p">.</span><span class="n">EOF</span>
</span><span class='line'>                <span class="n">nilai</span> <span class="o">=</span> <span class="n">nilai</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">rs</span><span class="p">(</span><span class="s">&quot;matapelajaran_kode&quot;</span><span class="p">).</span><span class="n">Value</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;=&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">rs</span><span class="p">(</span><span class="s">&quot;nilai&quot;</span><span class="p">).</span><span class="n">Value</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;, &quot;</span>
</span><span class='line'>                <span class="n">rs</span><span class="p">.</span><span class="n">MoveNext</span>
</span><span class='line'>            <span class="k">Loop</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">If</span> <span class="n">Len</span><span class="p">(</span><span class="n">nilai</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">gt</span><span class="err">;</span> <span class="mi">0</span> <span class="k">Then</span>
</span><span class='line'>            <span class="n">nilai</span> <span class="o">=</span> <span class="n">Left</span><span class="p">(</span><span class="n">nilai</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">nilai</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Nilai ulangan (&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nama</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;) : &quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nilai</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">Else</span>
</span><span class='line'>            <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Nilai ulangan (&quot;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">nama</span> <span class="o">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="s">&quot;) sedang dalam proses pendataan&quot;</span>
</span><span class='line'>        <span class="k">End</span> <span class="k">If</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Case</span> <span class="k">Else</span>
</span><span class='line'>        <span class="n">getBalasanSms</span> <span class="o">=</span> <span class="s">&quot;Keyword sms salah&quot;</span>
</span><span class='line'><span class="k">End</span> <span class="k">Select</span>
</span><span class='line'><span class="na">&lt;/code&gt;</span><span class="o">&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="na">&lt;p&gt;</span><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><a href="http://coding4ever.files.wordpress.com/2010/07/12072010-2.jpg"><img src="http://coding4ever.files.wordpress.com/2010/07/12072010-2.jpg?w=300" alt="" /></a></p>

<p>Untuk mengetahui daftar hp/modem apa saja yang didukung, jangan sungkan dan malu-malu untuk mengklik link <a href="http://www.activexperts.com/xmstoolkit/gsmlist/">ini</a>.</p>

<p>Selamat <a href="https://github.com/k4m4r82/SMSGateway">MENCOBA</a> :)</p>
]]></content>
  </entry>
  
</feed>
